(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[4],{xsWp:function(t,e,n){"use strict";(function(t){var e=n("mrSG"),r=n("zIRd"),i=n("q/0M"),o=n("qOnz"),u=n("x7I3"),s=n("/6Yf"),a={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},c=function(t){function n(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(e.c)(n,t),n}(Error),h=new i.b("@firebase/firestore");function f(){return h.logLevel}function l(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(h.logLevel<=i.a.DEBUG){var o=n.map(v);h.debug.apply(h,Object(e.g)(["Firestore (8.0.1): "+t],o))}}function p(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(h.logLevel<=i.a.ERROR){var o=n.map(v);h.error.apply(h,Object(e.g)(["Firestore (8.0.1): "+t],o))}}function d(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(h.logLevel<=i.a.WARN){var o=n.map(v);h.warn.apply(h,Object(e.g)(["Firestore (8.0.1): "+t],o))}}function v(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function y(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.0.1) INTERNAL ASSERTION FAILED: "+t;throw p(e),new Error(e)}function m(t,e){t||y()}function g(t,e){return t}function b(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var w=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=b(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function I(t,e){return t<e?-1:t>e?1:0}function E(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function O(t){return t+"\0"}var _=function(){function t(t){this.i=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.i,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},t.prototype.o=function(){return 2*this.i.length},t.prototype.u=function(t){return I(this.i,t.i)},t.prototype.isEqual=function(t){return this.i===t.i},t}();_.h=new _("");var T=function(){function t(t){this.l=t}return t.fromBase64String=function(e){try{return new t(_.fromBase64String(e))}catch(e){throw new c(a.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(_.fromUint8Array(e))},t.prototype.toBase64=function(){return this.l.toBase64()},t.prototype.toUint8Array=function(){return this.l.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.l.isEqual(t.l)},t}();function N(){if("undefined"==typeof Uint8Array)throw new c(a.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function A(){if("undefined"==typeof atob)throw new c(a.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var D=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.fromBase64String=function(t){A();try{return new n(_.fromBase64String(t))}catch(t){throw new c(a.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},n.fromUint8Array=function(t){return N(),new n(_.fromUint8Array(t))},n.prototype.toBase64=function(){return A(),t.prototype.toBase64.call(this)},n.prototype.toUint8Array=function(){return N(),t.prototype.toUint8Array.call(this)},n.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},n}(T),j=function(t,e,n,r,i,o){this._=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.T=o},k=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"I",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.u=function(t){return I(this.projectId,t.projectId)||I(this.database,t.database)},t}();function x(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function S(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function P(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var L=function(){function t(t,e){this.m=t,this.A=e,this.R={}}return t.prototype.get=function(t){var e=this.m(t),n=this.R[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];if(this.A(u,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.m(t),r=this.R[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.A(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.R[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.m(t),n=this.R[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.A(n[r][0],t))return 1===n.length?delete this.R[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){S(this.R,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];t(u,s)}}))},t.prototype.P=function(){return P(this.R)},t}(),V=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new c(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new c(a.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new c(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new c(a.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.g=function(t){return this.seconds===t.seconds?I(this.nanoseconds,t.nanoseconds):I(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),R=function(){function t(t){this.timestamp=t}return t.V=function(e){return new t(e)},t.min=function(){return new t(new V(0,0))},t.prototype.u=function(t){return this.timestamp.g(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.p=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.v=function(){return this.timestamp},t}(),U=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&y(),void 0===n?n=t.length-e:n>t.length-e&&y(),this.segments=t,this.offset=e,this.S=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.S},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.D(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.C(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.N=function(t){return t=void 0===t?1:t,this.C(this.segments,this.offset+t,this.length-t)},t.prototype.F=function(){return this.C(this.segments,this.offset,this.length-1)},t.prototype.O=function(){return this.segments[this.offset]},t.prototype.k=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.P=function(){return 0===this.length},t.prototype.M=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.$=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.L=function(){return this.segments.slice(this.offset,this.limit())},t.D=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),C=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.C=function(t,e,r){return new n(t,e,r)},n.prototype.B=function(){return this.L().join("/")},n.prototype.toString=function(){return this.B()},n.q=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i];if(u.indexOf("//")>=0)throw new c(a.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");r.push.apply(r,u.split("/").filter((function(t){return t.length>0})))}return new n(r)},n.U=function(){return new n([])},n}(U),q=/^[_a-zA-Z][_a-zA-Z0-9]*$/,M=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.C=function(t,e,r){return new n(t,e,r)},n.K=function(t){return q.test(t)},n.prototype.B=function(){return this.L().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),n.K(t)||(t="`"+t+"`"),t})).join(".")},n.prototype.toString=function(){return this.B()},n.prototype.W=function(){return 1===this.length&&"__name__"===this.get(0)},n.j=function(){return new n(["__name__"])},n.G=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new c(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},u=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new c(a.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var h=t[i+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new c(a.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,i+=2}else"`"===s?(u=!u,i++):"."!==s||u?(r+=s,i++):(o(),i++)}if(o(),u)throw new c(a.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.U=function(){return new n([])},n}(U),F=function(){function t(t){this.path=t}return t.H=function(e){return new t(C.q(e))},t.Y=function(e){return new t(C.q(e).N(5))},t.prototype.J=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===C.D(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.D=function(t,e){return C.D(t.path,e.path)},t.X=function(t){return t.length%2==0},t.Z=function(e){return new t(new C(e.slice()))},t}();function B(t){return null==t}function z(t){return 0===t&&1/t==-1/0}function G(t){return"number"==typeof t&&Number.isInteger(t)&&!z(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var K=function(t,e,n,r,i,o,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=u,this.tt=null};function W(t,e,n,r,i,o,u){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),new K(t,e,n,r,i,o,u)}function Q(t){var e=g(t);if(null===e.tt){var n=e.path.B();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.B()+t.op.toString()+Ut(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return(e=t).field.B()+e.dir;var e})).join(","),B(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Mn(e.startAt)),e.endAt&&(n+="|ub:",n+=Mn(e.endAt)),e.tt=n}return e.tt}function H(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Kn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Pt(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Bn(t.startAt,e.startAt)&&Bn(t.endAt,e.endAt)}function Y(t){return F.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}var J,X,Z=function(){function t(t,e,n,r,i,o,u){void 0===i&&(i=R.min()),void 0===o&&(o=R.min()),void 0===u&&(u=_.h),this.target=t,this.targetId=e,this.et=n,this.sequenceNumber=r,this.nt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u}return t.prototype.st=function(e){return new t(this.target,this.targetId,this.et,e,this.nt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.it=function(e,n){return new t(this.target,this.targetId,this.et,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.rt=function(e){return new t(this.target,this.targetId,this.et,this.sequenceNumber,this.nt,e,this.resumeToken)},t}(),$=function(t){this.count=t};function tt(t){switch(t){case a.OK:return y();case a.CANCELLED:case a.UNKNOWN:case a.DEADLINE_EXCEEDED:case a.RESOURCE_EXHAUSTED:case a.INTERNAL:case a.UNAVAILABLE:case a.UNAUTHENTICATED:return!1;case a.INVALID_ARGUMENT:case a.NOT_FOUND:case a.ALREADY_EXISTS:case a.PERMISSION_DENIED:case a.FAILED_PRECONDITION:case a.ABORTED:case a.OUT_OF_RANGE:case a.UNIMPLEMENTED:case a.DATA_LOSS:return!0;default:return y()}}function et(t){if(void 0===t)return p("GRPC error has no .code"),a.UNKNOWN;switch(t){case J.OK:return a.OK;case J.CANCELLED:return a.CANCELLED;case J.UNKNOWN:return a.UNKNOWN;case J.DEADLINE_EXCEEDED:return a.DEADLINE_EXCEEDED;case J.RESOURCE_EXHAUSTED:return a.RESOURCE_EXHAUSTED;case J.INTERNAL:return a.INTERNAL;case J.UNAVAILABLE:return a.UNAVAILABLE;case J.UNAUTHENTICATED:return a.UNAUTHENTICATED;case J.INVALID_ARGUMENT:return a.INVALID_ARGUMENT;case J.NOT_FOUND:return a.NOT_FOUND;case J.ALREADY_EXISTS:return a.ALREADY_EXISTS;case J.PERMISSION_DENIED:return a.PERMISSION_DENIED;case J.FAILED_PRECONDITION:return a.FAILED_PRECONDITION;case J.ABORTED:return a.ABORTED;case J.OUT_OF_RANGE:return a.OUT_OF_RANGE;case J.UNIMPLEMENTED:return a.UNIMPLEMENTED;case J.DATA_LOSS:return a.DATA_LOSS;default:return y()}}(X=J||(J={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var nt=function(){function t(t,e){this.D=t,this.root=e||it.EMPTY}return t.prototype.ot=function(e,n){return new t(this.D,this.root.ot(e,n,this.D).copy(null,null,it.at,null,null))},t.prototype.remove=function(e){return new t(this.D,this.root.remove(e,this.D).copy(null,null,it.at,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.P();){var n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.P();){var r=this.D(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.P=function(){return this.root.P()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.ct=function(){return this.root.ct()},t.prototype.ut=function(){return this.root.ut()},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.forEach=function(t){this.ht((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ht((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.lt=function(t){return this.root.lt(t)},t.prototype._t=function(){return new rt(this.root,null,this.D,!1)},t.prototype.ft=function(t){return new rt(this.root,t,this.D,!1)},t.prototype.dt=function(){return new rt(this.root,null,this.D,!0)},t.prototype.wt=function(t){return new rt(this.root,t,this.D,!0)},t}(),rt=function(){function t(t,e,n,r){this.Et=r,this.Tt=[];for(var i=1;!t.P();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Et?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.Et?t.right:t.left}}return t.prototype.It=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.Et)for(t=t.left;!t.P();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.P();)this.Tt.push(t),t=t.left;return e},t.prototype.At=function(){return this.Tt.length>0},t.prototype.Rt=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},t}(),it=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.P=function(){return!1},t.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},t.prototype.lt=function(t){return this.right.lt(t)||t(this.key,this.value)||this.left.lt(t)},t.prototype.min=function(){return this.left.P()?this:this.left.min()},t.prototype.ct=function(){return this.min().key},t.prototype.ut=function(){return this.right.P()?this.key:this.right.ut()},t.prototype.ot=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ot(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ot(t,e,n))).Pt()},t.prototype.gt=function(){if(this.left.P())return t.EMPTY;var e=this;return e.left.yt()||e.left.left.yt()||(e=e.Vt()),(e=e.copy(null,null,null,e.left.gt(),null)).Pt()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.P()||i.left.yt()||i.left.left.yt()||(i=i.Vt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.yt()&&(i=i.bt()),i.right.P()||i.right.yt()||i.right.left.yt()||(i=i.vt()),0===n(e,i.key)){if(i.right.P())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.gt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Pt()},t.prototype.yt=function(){return this.color},t.prototype.Pt=function(){var t=this;return t.right.yt()&&!t.left.yt()&&(t=t.St()),t.left.yt()&&t.left.left.yt()&&(t=t.bt()),t.left.yt()&&t.right.yt()&&(t=t.Dt()),t},t.prototype.Vt=function(){var t=this.Dt();return t.right.left.yt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.bt())).St()).Dt()),t},t.prototype.vt=function(){var t=this.Dt();return t.left.left.yt()&&(t=(t=t.bt()).Dt()),t},t.prototype.St=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.bt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Dt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ct=function(){var t=this.Nt();return Math.pow(2,t)<=this.size+1},t.prototype.Nt=function(){if(this.yt()&&this.left.yt())throw y();if(this.right.yt())throw y();var t=this.left.Nt();if(t!==this.right.Nt())throw y();return t+(this.yt()?0:1)},t}();it.EMPTY=null,it.RED=!0,it.at=!1,it.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw y()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw y()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.ot=function(t,e,n){return new it(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.P=function(){return!0},t.prototype.ht=function(t){return!1},t.prototype.lt=function(t){return!1},t.prototype.ct=function(){return null},t.prototype.ut=function(){return null},t.prototype.yt=function(){return!1},t.prototype.Ct=function(){return!0},t.prototype.Nt=function(){return 0},t}());var ot=function(){function t(t){this.D=t,this.data=new nt(this.D)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.ct()},t.prototype.last=function(){return this.data.ut()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ht((function(e,n){return t(e),!1}))},t.prototype.xt=function(t,e){for(var n=this.data.ft(t[0]);n.At();){var r=n.It();if(this.D(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ft=function(t,e){var n;for(n=void 0!==e?this.data.ft(e):this.data._t();n.At();)if(!t(n.It().key))return},t.prototype.Ot=function(t){var e=this.data.ft(t);return e.At()?e.It().key:null},t.prototype._t=function(){return new ut(this.data._t())},t.prototype.ft=function(t){return new ut(this.data.ft(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).ot(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.P=function(){return this.data.P()},t.prototype.kt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data._t(),r=e.data._t();n.At();){var i=n.It().key,o=r.It().key;if(0!==this.D(i,o))return!1}return!0},t.prototype.L=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.D);return n.data=e,n},t}(),ut=function(){function t(t){this.Mt=t}return t.prototype.It=function(){return this.Mt.It().key},t.prototype.At=function(){return this.Mt.At()},t}(),st=new nt(F.D);function at(){return st}function ct(){return at()}var ht=new nt(F.D);function ft(){return ht}var lt=new nt(F.D),pt=new ot(F.D);function dt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=pt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var vt=new ot(I);function yt(){return vt}var mt=function(){function t(t){this.D=t?function(e,n){return t(e,n)||F.D(e.key,n.key)}:function(t,e){return F.D(t.key,e.key)},this.$t=ft(),this.Lt=new nt(this.D)}return t.Bt=function(e){return new t(e.D)},t.prototype.has=function(t){return null!=this.$t.get(t)},t.prototype.get=function(t){return this.$t.get(t)},t.prototype.first=function(){return this.Lt.ct()},t.prototype.last=function(){return this.Lt.ut()},t.prototype.P=function(){return this.Lt.P()},t.prototype.indexOf=function(t){var e=this.$t.get(t);return e?this.Lt.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.Lt.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Lt.ht((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.$t.ot(t.key,t),e.Lt.ot(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.$t.remove(t),this.Lt.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Lt._t(),r=e.Lt._t();n.At();){var i=n.It().key,o=r.It().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.D=this.D,r.$t=e,r.Lt=n,r},t}(),gt=function(){function t(){this.qt=new nt(F.D)}return t.prototype.track=function(t){var e=t.doc.key,n=this.qt.get(e);n?0!==t.type&&3===n.type?this.qt=this.qt.ot(e,t):3===t.type&&1!==n.type?this.qt=this.qt.ot(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.qt=this.qt.ot(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.qt=this.qt.remove(e):1===t.type&&2===n.type?this.qt=this.qt.ot(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.qt=this.qt.ot(e,{type:2,doc:t.doc}):y():this.qt=this.qt.ot(e,t)},t.prototype.Ut=function(){var t=[];return this.qt.ht((function(e,n){t.push(n)})),t},t}(),bt=function(){function t(t,e,n,r,i,o,u,s){this.query=t,this.docs=e,this.Kt=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=u,this.jt=s}return t.Gt=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,mt.Bt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Qt.P()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Tn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Kt.isEqual(t.Kt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),wt=function(){function t(t,e,n,r,i){this.nt=t,this.zt=e,this.Ht=n,this.Yt=r,this.Jt=i}return t.Xt=function(e,n){var r=new Map;return r.set(e,It.Zt(e,n)),new t(R.min(),r,yt(),at(),dt())},t}(),It=function(){function t(t,e,n,r,i){this.resumeToken=t,this.te=e,this.ee=n,this.ne=r,this.se=i}return t.Zt=function(e,n){return new t(_.h,n,dt(),dt(),dt())},t}(),Et=function(t,e,n,r){this.ie=t,this.removedTargetIds=e,this.key=n,this.re=r},Ot=function(t,e){this.targetId=t,this.oe=e},_t=function(t,e,n,r){void 0===n&&(n=_.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Tt=function(){function t(){this.ae=0,this.ce=Dt(),this.ue=_.h,this.he=!1,this.le=!0}return Object.defineProperty(t.prototype,"te",{get:function(){return this.he},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_e",{get:function(){return 0!==this.ae},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fe",{get:function(){return this.le},enumerable:!1,configurable:!0}),t.prototype.de=function(t){t.o()>0&&(this.le=!0,this.ue=t)},t.prototype.we=function(){var t=dt(),e=dt(),n=dt();return this.ce.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:y()}})),new It(this.ue,this.he,t,e,n)},t.prototype.Ee=function(){this.le=!1,this.ce=Dt()},t.prototype.Te=function(t,e){this.le=!0,this.ce=this.ce.ot(t,e)},t.prototype.Ie=function(t){this.le=!0,this.ce=this.ce.remove(t)},t.prototype.me=function(){this.ae+=1},t.prototype.Ae=function(){this.ae-=1},t.prototype.Re=function(){this.le=!0,this.he=!0},t}(),Nt=function(){function t(t){this.Pe=t,this.ge=new Map,this.ye=at(),this.Ve=At(),this.pe=new ot(I)}return t.prototype.be=function(t){for(var e=0,n=t.ie;e<n.length;e++){var r=n[e];t.re instanceof cn?this.ve(r,t.re):t.re instanceof hn&&this.Se(r,t.key,t.re)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var u=o[i];this.Se(u,t.key,t.re)}},t.prototype.De=function(t){var e=this;this.Ce(t,(function(n){var r=e.Ne(n);switch(t.state){case 0:e.xe(n)&&r.de(t.resumeToken);break;case 1:r.Ae(),r._e||r.Ee(),r.de(t.resumeToken);break;case 2:r.Ae(),r._e||e.removeTarget(n);break;case 3:e.xe(n)&&(r.Re(),r.de(t.resumeToken));break;case 4:e.xe(n)&&(e.Fe(n),r.de(t.resumeToken));break;default:y()}}))},t.prototype.Ce=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.ge.forEach((function(t,r){n.xe(r)&&e(r)}))},t.prototype.Oe=function(t){var e=t.targetId,n=t.oe.count,r=this.ke(e);if(r){var i=r.target;if(Y(i))if(0===n){var o=new F(i.path);this.Se(e,o,new hn(o,R.min()))}else m(1===n);else this.Me(e)!==n&&(this.Fe(e),this.pe=this.pe.add(e))}},t.prototype.$e=function(t){var e=this,n=new Map;this.ge.forEach((function(r,i){var o=e.ke(i);if(o){if(r.te&&Y(o.target)){var u=new F(o.target.path);null!==e.ye.get(u)||e.Le(i,u)||e.Se(i,u,new hn(u,t))}r.fe&&(n.set(i,r.we()),r.Ee())}}));var r=dt();this.Ve.forEach((function(t,n){var i=!0;n.Ft((function(t){var n=e.ke(t);return!n||2===n.et||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new wt(t,n,this.pe,this.ye,r);return this.ye=at(),this.Ve=At(),this.pe=new ot(I),i},t.prototype.ve=function(t,e){if(this.xe(t)){var n=this.Le(t,e.key)?2:0;this.Ne(t).Te(e.key,n),this.ye=this.ye.ot(e.key,e),this.Ve=this.Ve.ot(e.key,this.Be(e.key).add(t))}},t.prototype.Se=function(t,e,n){if(this.xe(t)){var r=this.Ne(t);this.Le(t,e)?r.Te(e,1):r.Ie(e),this.Ve=this.Ve.ot(e,this.Be(e).delete(t)),n&&(this.ye=this.ye.ot(e,n))}},t.prototype.removeTarget=function(t){this.ge.delete(t)},t.prototype.Me=function(t){var e=this.Ne(t).we();return this.Pe.qe(t).size+e.ee.size-e.se.size},t.prototype.me=function(t){this.Ne(t).me()},t.prototype.Ne=function(t){var e=this.ge.get(t);return e||(e=new Tt,this.ge.set(t,e)),e},t.prototype.Be=function(t){var e=this.Ve.get(t);return e||(e=new ot(I),this.Ve=this.Ve.ot(t,e)),e},t.prototype.xe=function(t){var e=null!==this.ke(t);return e||l("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ke=function(t){var e=this.ge.get(t);return e&&e._e?null:this.Pe.Ue(t)},t.prototype.Fe=function(t){var e=this;this.ge.set(t,new Tt),this.Pe.qe(t).forEach((function(n){e.Se(t,n,null)}))},t.prototype.Le=function(t,e){return this.Pe.qe(t).has(e)},t}();function At(){return new nt(F.D)}function Dt(){return new nt(F.D)}function jt(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function kt(t){var e=Ct(t.mapValue.fields.__local_write_time__.timestampValue);return new V(e.seconds,e.nanos)}var xt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function St(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?jt(t)?4:10:y()}function Pt(t,e){var n=St(t);if(n!==St(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return kt(t).isEqual(kt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Ct(t.timestampValue),r=Ct(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Mt(t.bytesValue).isEqual(Mt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return qt(t.geoPointValue.latitude)===qt(e.geoPointValue.latitude)&&qt(t.geoPointValue.longitude)===qt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return qt(t.integerValue)===qt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=qt(t.doubleValue),r=qt(e.doubleValue);return n===r?z(n)===z(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return E(t.arrayValue.values||[],e.arrayValue.values||[],Pt);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(x(n)!==x(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Pt(n[i],r[i])))return!1;return!0}(t,e);default:return y()}}function Lt(t,e){return void 0!==(t.values||[]).find((function(t){return Pt(t,e)}))}function Vt(t,e){var n=St(t),r=St(e);if(n!==r)return I(n,r);switch(n){case 0:return 0;case 1:return I(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=qt(t.integerValue||t.doubleValue),r=qt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Rt(t.timestampValue,e.timestampValue);case 4:return Rt(kt(t),kt(e));case 5:return I(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Mt(t),r=Mt(e);return n.u(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=I(n[i],r[i]);if(0!==o)return o}return I(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=I(qt(t.latitude),qt(e.latitude));return 0!==n?n:I(qt(t.longitude),qt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Vt(n[i],r[i]);if(o)return o}return I(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var u=0;u<r.length&&u<o.length;++u){var s=I(r[u],o[u]);if(0!==s)return s;var a=Vt(n[r[u]],i[o[u]]);if(0!==a)return a}return I(r.length,o.length)}(t.mapValue,e.mapValue);default:throw y()}}function Rt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return I(t,e);var n=Ct(t),r=Ct(e),i=I(n.seconds,r.seconds);return 0!==i?i:I(n.nanos,r.nanos)}function Ut(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Ct(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Mt(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,F.Y(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var u=o[i];r?r=!1:n+=",",n+=u+":"+t(e.fields[u])}return n+"}"}(e.mapValue):y();var n,r}(t)}function Ct(t){if(m(!!t),"string"==typeof t){var e=0,n=xt.exec(t);if(m(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:qt(t.seconds),nanos:qt(t.nanos)}}function qt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Mt(t){return"string"==typeof t?_.fromBase64String(t):_.fromUint8Array(t)}function Ft(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.B()}}function Bt(t){return!!t&&"integerValue"in t}function zt(t){return!!t&&"arrayValue"in t}function Gt(t){return!!t&&"nullValue"in t}function Kt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Wt(t){return!!t&&"mapValue"in t}var Qt={asc:"ASCENDING",desc:"DESCENDING"},Ht={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yt=function(t,e){this._=t,this.Ke=e};function Jt(t){return{integerValue:""+t}}function Xt(t,e){if(t.Ke){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:z(e)?"-0":e}}function Zt(t,e){return G(e)?Jt(e):Xt(t,e)}function $t(t,e){return t.Ke?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function te(t,e){return t.Ke?e.toBase64():e.toUint8Array()}function ee(t,e){return $t(t,e.v())}function ne(t){return m(!!t),R.V(function(t){var e=Ct(t);return new V(e.seconds,e.nanos)}(t))}function re(t,e){return function(t){return new C(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).B()}function ie(t){var e=C.q(t);return m(Ne(e)),e}function oe(t,e){return re(t._,e.path)}function ue(t,e){var n=ie(e);return m(n.get(1)===t._.projectId),m(!n.get(3)&&!t._.database||n.get(3)===t._.database),new F(he(n))}function se(t,e){return re(t._,e)}function ae(t){var e=ie(t);return 4===e.length?C.U():he(e)}function ce(t){return new C(["projects",t._.projectId,"databases",t._.database]).B()}function he(t){return m(t.length>4&&"documents"===t.get(4)),t.N(5)}function fe(t,e,n){return{name:oe(t,e),fields:n.proto.mapValue.fields}}function le(t,e){var n;if(e instanceof Je)n={update:fe(t,e.key,e.value)};else if(e instanceof nn)n={delete:oe(t,e.key)};else if(e instanceof Xe)n={update:fe(t,e.key,e.data),updateMask:Te(e.Qe)};else if(e instanceof $e)n={transform:{document:oe(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof xe)return{fieldPath:e.field.B(),setToServerValue:"REQUEST_TIME"};if(n instanceof Se)return{fieldPath:e.field.B(),appendMissingElements:{values:n.elements}};if(n instanceof Le)return{fieldPath:e.field.B(),removeAllFromArray:{values:n.elements}};if(n instanceof Re)return{fieldPath:e.field.B(),increment:n.We};throw y()}(0,t)}))}};else{if(!(e instanceof rn))return y();n={verify:oe(t,e.key)}}return e.Ge.je||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ee(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:y()}(t,e.Ge)),n}function pe(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Be.updateTime(ne(t.updateTime)):void 0!==t.exists?Be.exists(t.exists):Be.ze()}(e.currentDocument):Be.ze();if(e.update){e.update.name;var r=ue(t,e.update.name),i=new on({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new qe(e.map((function(t){return M.G(t)})))}(e.updateMask);return new Xe(r,i,o,n)}return new Je(r,i,n)}if(e.delete){var u=ue(t,e.delete);return new nn(u,n)}if(e.transform){var s=ue(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)m("REQUEST_TIME"===e.setToServerValue),n=new xe;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new Se(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new Le(i)}else"increment"in e?n=new Re(t,e.increment):y();var o=M.G(e.fieldPath);return new Me(o,n)}(t,e)}));return m(!0===n.exists),new $e(s,a)}if(e.verify){var c=ue(t,e.verify);return new rn(c,n)}return y()}function de(t,e){return{documents:[se(t,e.path)]}}function ve(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=se(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=se(t,r.F()),n.structuredQuery.from=[{collectionId:r.k()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(Kt(t.value))return{unaryFilter:{field:Ie(t.field),op:"IS_NAN"}};if(Gt(t.value))return{unaryFilter:{field:Ie(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Kt(t.value))return{unaryFilter:{field:Ie(t.field),op:"IS_NOT_NAN"}};if(Gt(t.value))return{unaryFilter:{field:Ie(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ie(t.field),op:we(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Ie(t.field),direction:be(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var u=function(t,e){return t.Ke||B(e)?e:{value:e}}(t,e.limit);return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=me(e.startAt)),e.endAt&&(n.structuredQuery.endAt=me(e.endAt)),n}function ye(t){var e=ae(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){m(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var u=[];n.where&&(u=function t(e){return e?void 0!==e.unaryFilter?[_e(e)]:void 0!==e.fieldFilter?[Oe(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):y():[]}(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(t){return function(t){return new zn(Ee(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return B(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ge(n.startAt));var h=null;return n.endAt&&(h=ge(n.endAt)),In(pn(e,i,s,u,a,"F",c,h))}function me(t){return{before:t.before,values:t.position}}function ge(t){var e=!!t.before,n=t.values||[];return new qn(n,e)}function be(t){return Qt[t]}function we(t){return Ht[t]}function Ie(t){return{fieldPath:t.B()}}function Ee(t){return M.G(t.fieldPath)}function Oe(t){return kn.create(Ee(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return y()}}(t.fieldFilter.op),t.fieldFilter.value)}function _e(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ee(t.unaryFilter.field);return kn.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ee(t.unaryFilter.field);return kn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ee(t.unaryFilter.field);return kn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ee(t.unaryFilter.field);return kn.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return y()}}function Te(t){var e=[];return t.fields.forEach((function(t){return e.push(t.B())})),{fieldPaths:e}}function Ne(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Ae=function(){this.He=void 0};function De(t,e,n){return t instanceof xe?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Se?Pe(t,e):t instanceof Le?Ve(t,e):function(t,e){var n=ke(t,e),r=Ue(n)+Ue(t.We);return Bt(n)&&Bt(t.We)?Jt(r):Xt(t.serializer,r)}(t,e)}function je(t,e,n){return t instanceof Se?Pe(t,e):t instanceof Le?Ve(t,e):n}function ke(t,e){return t instanceof Re?Bt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var xe=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n}(Ae),Se=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(e.c)(n,t),n}(Ae);function Pe(t,e){for(var n=Ce(e),r=function(t){n.some((function(e){return Pt(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Le=function(t){function n(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(e.c)(n,t),n}(Ae);function Ve(t,e){for(var n=Ce(e),r=function(t){n=n.filter((function(e){return!Pt(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Re=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.We=n,r}return Object(e.c)(n,t),n}(Ae);function Ue(t){return qt(t.integerValue||t.doubleValue)}function Ce(t){return zt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var qe=function(){function t(t){this.fields=t,t.sort(M.D)}return t.prototype.Ye=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].M(t))return!0;return!1},t.prototype.isEqual=function(t){return E(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Me=function(t,e){this.field=t,this.transform=e},Fe=function(t,e){this.version=t,this.transformResults=e},Be=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.ze=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function ze(t,e){return void 0!==t.updateTime?e instanceof cn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof cn}var Ge=function(){};function Ke(t,e,n){return t instanceof Je?function(t,e,n){return new cn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Xe?function(t,e,n){if(!ze(t.Ge,e))return new fn(t.key,n.version);var r=Ze(t,e);return new cn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof $e?function(t,e,n){if(m(null!=n.transformResults),!ze(t.Ge,e))return new fn(t.key,n.version);var r=tn(t,e),i=function(t,e,n){var r=[];m(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],u=o.transform,s=null;e instanceof cn&&(s=e.field(o.field)),r.push(je(u,s,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,u=en(t,r.data(),i);return new cn(t.key,o,u,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new hn(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function We(t,e,n,r){return t instanceof Je?function(t,e){if(!ze(t.Ge,e))return e;var n=Ye(e);return new cn(t.key,n,t.value,{Je:!0})}(t,e):t instanceof Xe?function(t,e){if(!ze(t.Ge,e))return e;var n=Ye(e),r=Ze(t,e);return new cn(t.key,n,r,{Je:!0})}(t,e):t instanceof $e?function(t,e,n,r){if(!ze(t.Ge,e))return e;var i=tn(t,e),o=function(t,e,n,r){for(var i=[],o=0,u=t;o<u.length;o++){var s=u[o],a=s.transform,c=null;n instanceof cn&&(c=n.field(s.field)),null===c&&r instanceof cn&&(c=r.field(s.field)),i.push(De(a,c,e))}return i}(t.fieldTransforms,n,e,r),u=en(t,i.data(),o);return new cn(t.key,i.version,u,{Je:!0})}(t,e,r,n):function(t,e){return ze(t.Ge,e)?new hn(t.key,R.min()):e}(t,e)}function Qe(t,e){return t instanceof $e?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],u=e instanceof cn?e.field(o.field):void 0,s=ke(o.transform,u||null);null!=s&&(n=null==n?(new un).set(o.field,s):n.set(o.field,s))}return n?n.Xe():null}(t,e):null}function He(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ge.isEqual(e.Ge)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||E(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Se&&e instanceof Se||t instanceof Le&&e instanceof Le?E(t.elements,e.elements,Pt):t instanceof Re&&e instanceof Re?Pt(t.We,e.We):t instanceof xe&&e instanceof xe}(t.transform,e.transform)}(t,e)})))}function Ye(t){return t instanceof cn?t.version:R.min()}var Je=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ge=r,i.type=0,i}return Object(e.c)(n,t),n}(Ge),Xe=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Qe=r,o.Ge=i,o.type=1,o}return Object(e.c)(n,t),n}(Ge);function Ze(t,e){return function(t,e){var n=new un(e);return t.Qe.fields.forEach((function(e){if(!e.P()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Xe()}(t,e instanceof cn?e.data():on.empty())}var $e=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ge=Be.exists(!0),r}return Object(e.c)(n,t),n}(Ge);function tn(t,e){return e}function en(t,e,n){for(var r=new un(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Xe()}var nn=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=3,r}return Object(e.c)(n,t),n}(Ge),rn=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ge=n,r.type=4,r}return Object(e.c)(n,t),n}(Ge),on=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.P())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Wt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.k()])||null},t.prototype.isEqual=function(t){return Pt(this.proto,t.proto)},t}(),un=function(){function t(t){void 0===t&&(t=on.empty()),this.Ze=t,this.tn=new Map}return t.prototype.set=function(t,e){return this.en(t,e),this},t.prototype.delete=function(t){return this.en(t,null),this},t.prototype.en=function(t,e){for(var n=this.tn,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===St(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.k(),e)},t.prototype.Xe=function(){var t=this.nn(M.U(),this.tn);return null!=t?new on(t):this.Ze},t.prototype.nn=function(t,e){var n=this,r=!1,i=this.Ze.field(t),o=Wt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var u=n.nn(t.child(i),e);null!=u&&(o[i]=u,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function sn(t){var e=[];return S(t.fields||{},(function(t,n){var r=new M([t]);if(Wt(n)){var i=sn(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,u=i;o<u.length;o++){var s=u[o];e.push(r.child(s))}}else e.push(r)})),new qe(e)}var an=function(t,e){this.key=t,this.version=e},cn=function(t){function n(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).sn=r,o.Je=!!i.Je,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(e.c)(n,t),n.prototype.field=function(t){return this.sn.field(t)},n.prototype.data=function(){return this.sn},n.prototype.rn=function(){return this.sn.proto},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Je===t.Je&&this.hasCommittedMutations===t.hasCommittedMutations&&this.sn.isEqual(t.sn)},n.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.sn.toString()+", {hasLocalMutations: "+this.Je+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.Je||this.hasCommittedMutations},enumerable:!1,configurable:!0}),n}(an),hn=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(e.c)(n,t),n.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(an),fn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(an),ln=function(t,e,n,r,i,o,u,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===u&&(u=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.on=n,this.filters=r,this.limit=i,this.an=o,this.startAt=u,this.endAt=s,this.cn=null,this.un=null,this.startAt,this.endAt};function pn(t,e,n,r,i,o,u,s){return new ln(t,e,n,r,i,o,u,s)}function dn(t){return new ln(t)}function vn(t){return!B(t.limit)&&"F"===t.an}function yn(t){return!B(t.limit)&&"L"===t.an}function mn(t){return t.on.length>0?t.on[0].field:null}function gn(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.hn())return r.field}return null}function bn(t){return null!==t.collectionGroup}function wn(t){var e=g(t);if(null===e.cn){e.cn=[];var n=gn(e),r=mn(e);if(null!==n&&null===r)n.W()||e.cn.push(new zn(n)),e.cn.push(new zn(M.j(),"asc"));else{for(var i=!1,o=0,u=e.on;o<u.length;o++){var s=u[o];e.cn.push(s),s.field.W()&&(i=!0)}if(!i){var a=e.on.length>0?e.on[e.on.length-1].dir:"asc";e.cn.push(new zn(M.j(),a))}}}return e.cn}function In(t){var e=g(t);if(!e.un)if("F"===e.an)e.un=W(e.path,e.collectionGroup,wn(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=wn(e);r<i.length;r++){var o=i[r],u="desc"===o.dir?"asc":"desc";n.push(new zn(o.field,u))}var s=e.endAt?new qn(e.endAt.position,!e.endAt.before):null,a=e.startAt?new qn(e.startAt.position,!e.startAt.before):null;e.un=W(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.un}function En(t,e,n){return new ln(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function On(t,e){return new ln(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,e,t.endAt)}function _n(t,e){return new ln(t.path,t.collectionGroup,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,e)}function Tn(t,e){return H(In(t),In(e))&&t.an===e.an}function Nn(t){return Q(In(t))+"|lt:"+t.an}function An(t){return"Query(target="+function(t){var e=t.path.B();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.B()+" "+e.op+" "+Ut(e.value);var e})).join(", ")+"]"),B(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return(e=t).field.B()+" ("+e.dir+")";var e})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Mn(t.startAt)),t.endAt&&(e+=", endAt: "+Mn(t.endAt)),"Target("+e+")"}(In(t))+"; limitType="+t.an+")"}function Dn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.J(t.collectionGroup)&&t.path.M(n):F.X(t.path)?t.path.isEqual(n):t.path.$(n)}(t,e)&&function(t,e){for(var n=0,r=t.on;n<r.length;n++){var i=r[n];if(!i.field.W()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Fn(t.startAt,wn(t),e))&&(!t.endAt||!Fn(t.endAt,wn(t),e))}(t,e)}function jn(t){return function(e,n){for(var r=!1,i=0,o=wn(t);i<o.length;i++){var u=o[i],s=Gn(u,e,n);if(0!==s)return s;r=r||u.field.W()}return 0}}var kn=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(e.c)(n,t),n.create=function(t,e,r){return t.W()?"in"===e||"not-in"===e?this.ln(t,e,r):new xn(t,e,r):"array-contains"===e?new Vn(t,r):"in"===e?new Rn(t,r):"not-in"===e?new Un(t,r):"array-contains-any"===e?new Cn(t,r):new n(t,e,r)},n.ln=function(t,e,n){return"in"===e?new Sn(t,n):new Pn(t,n)},n.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this._n(Vt(e,this.value)):null!==e&&St(this.value)===St(e)&&this._n(Vt(e,this.value))},n.prototype._n=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return y()}},n.prototype.hn=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},n}((function(){})),xn=function(t){function n(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=F.Y(r.referenceValue),i}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=F.D(t.key,this.key);return this._n(e)},n}(kn),Sn=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ln("in",n),r}return Object(e.c)(n,t),n.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},n}(kn),Pn=function(t){function n(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ln("not-in",n),r}return Object(e.c)(n,t),n.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},n}(kn);function Ln(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return F.Y(t.referenceValue)}))}var Vn=function(t){function n(e,n){return t.call(this,e,"array-contains",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return zt(e)&&Lt(e.arrayValue,this.value)},n}(kn),Rn=function(t){function n(e,n){return t.call(this,e,"in",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Lt(this.value.arrayValue,e)},n}(kn),Un=function(t){function n(e,n){return t.call(this,e,"not-in",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){if(Lt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!Lt(this.value.arrayValue,e)},n}(kn),Cn=function(t){function n(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(e.c)(n,t),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!zt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Lt(e.value.arrayValue,t)}))},n}(kn),qn=function(t,e){this.position=t,this.before=e};function Mn(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Ut(t)})).join(",")}function Fn(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],u=t.position[i];if(r=o.field.W()?F.D(F.Y(u.referenceValue),n.key):Vt(u,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Bn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Pt(t.position[n],e.position[n]))return!1;return!0}var zn=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Gn(t,e,n){var r=t.field.W()?F.D(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Vt(r,i):y()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return y()}}function Kn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Wn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Qn=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.fn=t,this.dn=e,this.wn=n,this.En=r,this.Tn=i,this.In=0,this.mn=null,this.An=Date.now(),this.reset()}return t.prototype.reset=function(){this.In=0},t.prototype.Rn=function(){this.In=this.Tn},t.prototype.Pn=function(t){var e=this;this.cancel();var n=Math.floor(this.In+this.gn()),r=Math.max(0,Date.now()-this.An),i=Math.max(0,n-r);i>0&&l("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.In+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mn=this.fn.yn(this.dn,i,(function(){return e.An=Date.now(),t()})),this.In*=this.En,this.In<this.wn&&(this.In=this.wn),this.In>this.Tn&&(this.In=this.Tn)},t.prototype.Vn=function(){null!==this.mn&&(this.mn.pn(),this.mn=null)},t.prototype.cancel=function(){null!==this.mn&&(this.mn.cancel(),this.mn=null)},t.prototype.gn=function(){return(Math.random()-.5)*this.In},t}(),Hn=function(){function t(t){var e=this;this.bn=null,this.vn=null,this.result=void 0,this.error=void 0,this.Sn=!1,this.Dn=!1,t((function(t){e.Sn=!0,e.result=t,e.bn&&e.bn(t)}),(function(t){e.Sn=!0,e.error=t,e.vn&&e.vn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Dn&&y(),this.Dn=!0,this.Sn?this.error?this.Cn(n,this.error):this.Nn(e,this.result):new t((function(t,i){r.bn=function(n){r.Nn(e,n).next(t,i)},r.vn=function(e){r.Cn(n,e).next(t,i)}}))},t.prototype.xn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Fn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Nn=function(e,n){return e?this.Fn((function(){return e(n)})):t.resolve(n)},t.prototype.Cn=function(e,n){return e?this.Fn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.On=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.kn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.On(r)},t}(),Yn=function(){function n(t,e,r){this.name=t,this.version=e,this.Mn=r,12.2===n.$n(Object(o.h)())&&p("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return n.delete=function(t){return l("SimpleDb","Removing database:",t),er(window.indexedDB.deleteDatabase(t)).xn()},n.Ln=function(){if("undefined"==typeof indexedDB)return!1;if(n.Bn())return!0;var t=Object(o.h)(),e=n.$n(t),r=0<e&&e<10,i=n.qn(t),u=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||u)},n.Bn=function(){var e;return"undefined"!=typeof t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Un)},n.Kn=function(t,e){return t.store(e)},n.$n=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},n.qn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},n.prototype.Qn=function(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.db?[3,2]:(l("SimpleDb","Opening database:",this.name),n=this,[4,new Promise((function(e,n){var i=indexedDB.open(r.name,r.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){n(new Xn(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var r=e.target.error;"VersionError"===r.name?n(new c(a.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Xn(t,r))},i.onupgradeneeded=function(t){l("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;r.Mn.createOrUpgrade(e,i.transaction,t.oldVersion,r.version).next((function(){l("SimpleDb","Database upgrade to version "+r.version+" complete")}))}}))]);case 1:n.db=e.sent(),e.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return r.Wn(t)}),this.db)]}}))}))},n.prototype.jn=function(t){this.Wn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},n.prototype.runTransaction=function(t,n,r,i){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s,a,c;return Object(e.d)(this,(function(h){switch(h.label){case 0:o="readonly"===n,u=0,s=function(){var n,s,c,h,f;return Object(e.d)(this,(function(e){switch(e.label){case 0:++u,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,a.Qn(t)];case 2:return a.db=e.sent(),n=$n.open(a.db,t,o?"readonly":"readwrite",r),s=i(n).catch((function(t){return n.abort(t),Hn.reject(t)})).xn(),c={},s.catch((function(){})),[4,n.Gn];case 3:return[2,(c.value=(e.sent(),s),c)];case 4:return h=e.sent(),f="FirebaseError"!==h.name&&u<3,l("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),a.close(),f?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},a=this,h.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},n.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},n}(),Jn=function(){function t(t){this.zn=t,this.Hn=!1,this.Yn=null}return Object.defineProperty(t.prototype,"Sn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Jn",{get:function(){return this.Yn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Hn=!0},t.prototype.Xn=function(t){this.Yn=t},t.prototype.delete=function(){return er(this.zn.delete())},t}(),Xn=function(t){function n(e,n){var r=this;return(r=t.call(this,a.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(e.c)(n,t),n}(c);function Zn(t){return"IndexedDbTransactionError"===t.name}var $n=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Zn=new Wn,this.transaction.oncomplete=function(){n.Zn.resolve()},this.transaction.onabort=function(){e.error?n.Zn.reject(new Xn(t,e.error)):n.Zn.resolve()},this.transaction.onerror=function(e){var r=rr(e.target.error);n.Zn.reject(new Xn(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Xn(n,e)}},Object.defineProperty(t.prototype,"Gn",{get:function(){return this.Zn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Zn.reject(t),this.aborted||(l("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new tr(e)},t}(),tr=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(l("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(l("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),er(n)},t.prototype.add=function(t){return l("SimpleDb","ADD",this.store.name,t,t),er(this.store.add(t))},t.prototype.get=function(t){var e=this;return er(this.store.get(t)).next((function(n){return void 0===n&&(n=null),l("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return l("SimpleDb","DELETE",this.store.name,t),er(this.store.delete(t))},t.prototype.count=function(){return l("SimpleDb","COUNT",this.store.name),er(this.store.count())},t.prototype.ts=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.es(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.ns=function(t,e){l("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ss=!1;var r=this.cursor(n);return this.es(r,(function(t,e,n){return n.delete()}))},t.prototype.rs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.es(r,e)},t.prototype.os=function(t){var e=this.cursor({});return new Hn((function(n,r){e.onerror=function(t){var e=rr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.es=function(t,e){var n=[];return new Hn((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Jn(i),u=e(i.primaryKey,i.value,o);if(u instanceof Hn){var s=u.catch((function(t){return o.done(),Hn.reject(t)}));n.push(s)}o.Sn?r():null===o.Jn?i.continue():i.continue(o.Jn)}else r()}})).next((function(){return Hn.On(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ss?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function er(t){return new Hn((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=rr(t.target.error);n(e)}}))}var nr=!1;function rr(t){var e=Yn.$n(Object(o.h)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new c("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return nr||(nr=!0,setTimeout((function(){throw r}),0)),r}}return t}function ir(){return"undefined"!=typeof window?window:null}function or(){return"undefined"!=typeof document?document:null}var ur=function(){function t(t,e,n,r,i){this.cs=t,this.dn=e,this.us=n,this.op=r,this.hs=i,this.ls=new Wn,this.then=this.ls.promise.then.bind(this.ls.promise),this.ls.promise.catch((function(t){}))}return t._s=function(e,n,r,i,o){var u=new t(e,n,Date.now()+r,i,o);return u.start(r),u},t.prototype.start=function(t){var e=this;this.fs=setTimeout((function(){return e.ds()}),t)},t.prototype.pn=function(){return this.ds()},t.prototype.cancel=function(t){null!==this.fs&&(this.clearTimeout(),this.ls.reject(new c(a.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.ds=function(){var t=this;this.cs.ws((function(){return null!==t.fs?(t.clearTimeout(),t.op().then((function(e){return t.ls.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.fs&&(this.hs(this),clearTimeout(this.fs),this.fs=null)},t}(),sr=function(){function t(){var t=this;this.Es=Promise.resolve(),this.Ts=[],this.Is=!1,this.As=[],this.Rs=null,this.Ps=!1,this.gs=[],this.ys=new Qn(this,"async_queue_retry"),this.Vs=function(){var e=or();e&&l("AsyncQueue","Visibility state changed to "+e.visibilityState),t.ys.Vn()};var e=or();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vs)}return Object.defineProperty(t.prototype,"ps",{get:function(){return this.Is},enumerable:!1,configurable:!0}),t.prototype.ws=function(t){this.enqueue(t)},t.prototype.bs=function(t){this.vs(),this.Ss(t)},t.prototype.Ds=function(){if(!this.Is){this.Is=!0;var t=or();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vs)}},t.prototype.enqueue=function(t){return this.vs(),this.Is?new Promise((function(t){})):this.Ss(t)},t.prototype.Cs=function(t){var e=this;this.ws((function(){return e.Ts.push(t),e.Ns()}))},t.prototype.Ns=function(){return Object(e.b)(this,void 0,void 0,(function(){var t,n=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:if(0===this.Ts.length)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return e.sent(),this.Ts.shift(),this.ys.reset(),[3,4];case 3:if(!Zn(t=e.sent()))throw t;return l("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Ts.length>0&&this.ys.Pn((function(){return n.Ns()})),e.label=5;case 5:return[2]}}))}))},t.prototype.Ss=function(t){var e=this,n=this.Es.then((function(){return e.Ps=!0,t().catch((function(t){throw e.Rs=t,e.Ps=!1,p("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.Ps=!1,t}))}));return this.Es=n,n},t.prototype.yn=function(t,e,n){var r=this;this.vs(),this.gs.indexOf(t)>-1&&(e=0);var i=ur._s(this,t,e,n,(function(t){return r.xs(t)}));return this.As.push(i),i},t.prototype.vs=function(){this.Rs&&y()},t.prototype.Fs=function(){},t.prototype.Os=function(){return Object(e.b)(this,void 0,void 0,(function(){var t;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.Es];case 1:e.sent(),e.label=2;case 2:if(t!==this.Es)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.ks=function(t){for(var e=0,n=this.As;e<n.length;e++)if(n[e].dn===t)return!0;return!1},t.prototype.Ms=function(t){var e=this;return this.Os().then((function(){e.As.sort((function(t,e){return t.us-e.us}));for(var n=0,r=e.As;n<r.length;n++){var i=r[n];if(i.pn(),"all"!==t&&i.dn===t)break}return e.Os()}))},t.prototype.$s=function(t){this.gs.push(t)},t.prototype.xs=function(t){var e=this.As.indexOf(t);this.As.splice(e,1)},t}();function ar(t,e){if(p("AsyncQueue",e+": "+t),Zn(t))return new c(a.UNAVAILABLE,e+": "+t);throw t}var cr=function(){this.Ls=void 0,this.listeners=[]},hr=function(){this.Bs=new L((function(t){return Nn(t)}),Tn),this.onlineState="Unknown",this.qs=new Set};function fr(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c;return Object(e.d)(this,(function(e){switch(e.label){case 0:if(r=g(t),i=n.query,o=!1,(u=r.Bs.get(i))||(o=!0,u=new cr),!o)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),s=u,[4,r.Us(i)];case 2:return s.Ls=e.sent(),[3,4];case 3:return a=e.sent(),c=ar(a,"Initialization of query '"+An(n.query)+"' failed"),[2,void n.onError(c)];case 4:return r.Bs.set(i,u),u.listeners.push(n),n.Ks(r.onlineState),u.Ls&&n.Qs(u.Ls)&&vr(r),[2]}}))}))}function lr(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s;return Object(e.d)(this,(function(e){return r=g(t),i=n.query,o=!1,(u=r.Bs.get(i))&&(s=u.listeners.indexOf(n))>=0&&(u.listeners.splice(s,1),o=0===u.listeners.length),o?[2,(r.Bs.delete(i),r.Ws(i))]:[2]}))}))}function pr(t,e){for(var n=g(t),r=!1,i=0,o=e;i<o.length;i++){var u=o[i],s=u.query,a=n.Bs.get(s);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(u)&&(r=!0);a.Ls=u}}r&&vr(n)}function dr(t,e,n){var r=g(t),i=r.Bs.get(e);if(i)for(var o=0,u=i.listeners;o<u.length;o++)u[o].onError(n);r.Bs.delete(e)}function vr(t){t.qs.forEach((function(t){t.next()}))}var yr=function(){function t(t,e,n){this.query=t,this.js=e,this.Gs=!1,this.zs=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new bt(t.query,t.docs,t.Kt,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Gs?this.Hs(t)&&(this.js.next(t),o=!0):this.Ys(t,this.onlineState)&&(this.Js(t),o=!0),this.zs=t,o},t.prototype.onError=function(t){this.js.error(t)},t.prototype.Ks=function(t){this.onlineState=t;var e=!1;return this.zs&&!this.Gs&&this.Ys(this.zs,t)&&(this.Js(this.zs),e=!0),e},t.prototype.Ys=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Xs&&n||t.docs.P()&&"Offline"!==e)},t.prototype.Hs=function(t){if(t.docChanges.length>0)return!0;var e=this.zs&&this.zs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Js=function(t){t=bt.Gt(t.query,t.docs,t.Qt,t.fromCache),this.Gs=!0,this.js.next(t)},t}(),mr=function(){function t(t){this.uid=t}return t.prototype.Zs=function(){return null!=this.uid},t.prototype.ti=function(){return this.Zs()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();mr.UNAUTHENTICATED=new mr(null),mr.ei=new mr("google-credentials-uid"),mr.ni=new mr("first-party-uid");var gr=function(t,e){this.user=e,this.type="OAuth",this.si={},this.si.Authorization="Bearer "+t},br=function(){function t(){this.ii=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.ri=function(){},t.prototype.oi=function(t){this.ii=t,t(mr.UNAUTHENTICATED)},t.prototype.ai=function(){this.ii=null},t}(),wr=function(){function t(t){var e=this;this.ci=null,this.currentUser=mr.UNAUTHENTICATED,this.ui=!1,this.hi=0,this.ii=null,this.forceRefresh=!1,this.ci=function(){e.hi++,e.currentUser=e.li(),e.ui=!0,e.ii&&e.ii(e.currentUser)},this.hi=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.ci):(this.ci(null),t.get().then((function(t){e.auth=t,e.ci&&e.auth.addAuthTokenListener(e.ci)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.hi,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.hi!==e?(l("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(m("string"==typeof n.accessToken),new gr(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.ri=function(){this.forceRefresh=!0},t.prototype.oi=function(t){this.ii=t,this.ui&&t(this.currentUser)},t.prototype.ai=function(){this.auth&&this.auth.removeAuthTokenListener(this.ci),this.ci=null,this.ii=null},t.prototype.li=function(){var t=this.auth&&this.auth.getUid();return m(null===t||"string"==typeof t),new mr(t)},t}(),Ir=function(){function t(t,e){this._i=t,this.fi=e,this.type="FirstParty",this.user=mr.ni}return Object.defineProperty(t.prototype,"si",{get:function(){var t={"X-Goog-AuthUser":this.fi},e=this._i.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Er=function(){function t(t,e){this._i=t,this.fi=e}return t.prototype.getToken=function(){return Promise.resolve(new Ir(this._i,this.fi))},t.prototype.oi=function(t){t(mr.ni)},t.prototype.ai=function(){},t.prototype.ri=function(){},t}(),Or=function(){function t(t,e,n,r){this.batchId=t,this.di=e,this.baseMutations=n,this.mutations=r}return t.prototype.wi=function(t,e,n){for(var r=n.Ei,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Ke(o,e,r[i]))}return e},t.prototype.Ti=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=We(i,e,e,this.di))}for(var o=e,u=0,s=this.mutations;u<s.length;u++){var a=s[u];a.key.isEqual(t)&&(e=We(a,e,o,this.di))}return e},t.prototype.Ii=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.Ti(r.key,t.get(r.key));i&&(n=n.ot(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),dt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&E(this.mutations,t.mutations,(function(t,e){return He(t,e)}))&&E(this.baseMutations,t.baseMutations,(function(t,e){return He(t,e)}))},t}(),_r=function(){function t(t,e,n,r){this.batch=t,this.mi=e,this.Ei=n,this.Ai=r}return t.from=function(e,n,r){m(e.mutations.length===r.length);for(var i=lt,o=e.mutations,u=0;u<o.length;u++)i=i.ot(o[u].key,r[u].version);return new t(e,n,r,i)},t}(),Tr=function(){function t(){this.Ri=new L((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.Pi=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return this.gi},set:function(t){this.gi=t},enumerable:!1,configurable:!0}),t.prototype.yi=function(t,e){this.Vi(),this.readTime=e,this.Ri.set(t.key,t)},t.prototype.pi=function(t,e){this.Vi(),e&&(this.readTime=e),this.Ri.set(t,null)},t.prototype.bi=function(t,e){this.Vi();var n=this.Ri.get(e);return void 0!==n?Hn.resolve(n):this.vi(t,e)},t.prototype.getEntries=function(t,e){return this.Si(t,e)},t.prototype.apply=function(t){return this.Vi(),this.Pi=!0,this.Di(t)},t.prototype.Vi=function(){},t}(),Nr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ar=function(){function t(){this.Ci=[]}return t.prototype.Ni=function(t){this.Ci.push(t)},t.prototype.xi=function(){this.Ci.forEach((function(t){return t()}))},t}(),Dr=function(){function t(t,e,n){this.Fi=t,this.Oi=e,this.ki=n}return t.prototype.Mi=function(t,e){var n=this;return this.Oi.$i(t,e).next((function(r){return n.Li(t,e,r)}))},t.prototype.Li=function(t,e,n){return this.Fi.bi(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].Ti(e,t);return t}))},t.prototype.Bi=function(t,e,n){var r=ct();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].Ti(t,e);r=r.ot(t,e)})),r},t.prototype.qi=function(t,e){var n=this;return this.Fi.getEntries(t,e).next((function(e){return n.Ui(t,e)}))},t.prototype.Ui=function(t,e){var n=this;return this.Oi.Ki(t,e).next((function(r){var i=n.Bi(t,e,r),o=at();return i.forEach((function(t,e){e||(e=new hn(t,R.min())),o=o.ot(t,e)})),o}))},t.prototype.Qi=function(t,e,n){return function(t){return F.X(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Wi(t,e.path):bn(e)?this.ji(t,e,n):this.Gi(t,e,n)},t.prototype.Wi=function(t,e){return this.Mi(t,new F(e)).next((function(t){var e=ft();return t instanceof cn&&(e=e.ot(t.key,t)),e}))},t.prototype.ji=function(t,e,n){var r=this,i=e.collectionGroup,o=ft();return this.ki.zi(t,i).next((function(u){return Hn.forEach(u,(function(u){var s=function(t,e){return new ln(e,null,t.on.slice(),t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(e,u.child(i));return r.Gi(t,s,n).next((function(t){t.forEach((function(t,e){o=o.ot(t,e)}))}))})).next((function(){return o}))}))},t.prototype.Gi=function(t,e,n){var r,i,o=this;return this.Fi.Qi(t,e,n).next((function(n){return r=n,o.Oi.Hi(t,e)})).next((function(e){return i=e,o.Yi(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],u=0,s=o.mutations;u<s.length;u++){var a=s[u],c=a.key,h=r.get(c),f=We(a,h,h,o.di);r=f instanceof cn?r.ot(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Dn(e,n)||(r=r.remove(t))})),r}))},t.prototype.Yi=function(t,e,n){for(var r=dt(),i=0,o=e;i<o.length;i++)for(var u=0,s=o[i].mutations;u<s.length;u++){var a=s[u];a instanceof Xe&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Fi.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof cn&&(c=c.ot(t,e))})),c}))},t}(),jr=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.Ji=n,this.Xi=r}return t.Zi=function(e,n){for(var r=dt(),i=dt(),o=0,u=n.docChanges;o<u.length;o++){var s=u[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),kr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.tr=function(t){return n.er(t)},this.nr=function(t){return e.sr(t)})}return t.prototype.er=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.nr&&this.nr(t),t},t}();function xr(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],u=I(n,i);return 0===u?I(r,o):u}kr.ir=-1;var Sr=function(){function t(t){this.rr=t,this.buffer=new ot(xr),this.ar=0}return t.prototype.cr=function(){return++this.ar},t.prototype.ur=function(t){var e=[t,this.cr()];if(this.buffer.size<this.rr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();xr(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Pr={hr:!1,lr:0,_r:0,dr:0},Lr=function(){function t(t,e,n){this.wr=t,this.Er=e,this.Tr=n}return t.Ir=function(e){return new t(e,t.mr,t.Ar)},t}();Lr.mr=10,Lr.Ar=1e3,Lr.Rr=new Lr(41943040,Lr.mr,Lr.Ar),Lr.Pr=new Lr(-1,0,0);var Vr=function(){function t(t,e){this.gr=t,this.cs=e,this.yr=!1,this.Vr=null}return t.prototype.start=function(t){-1!==this.gr.params.wr&&this.pr(t)},t.prototype.stop=function(){this.Vr&&(this.Vr.cancel(),this.Vr=null)},Object.defineProperty(t.prototype,"br",{get:function(){return null!==this.Vr},enumerable:!1,configurable:!0}),t.prototype.pr=function(t){var n=this,r=this.yr?3e5:6e4;l("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.Vr=this.cs.yn("lru_garbage_collection",r,(function(){return Object(e.b)(n,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:this.Vr=null,this.yr=!0,e.label=1;case 1:return e.trys.push([1,3,,7]),[4,t.vr(this.gr)];case 2:return e.sent(),[3,7];case 3:return Zn(n=e.sent())?(l("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n),[3,6]):[3,4];case 4:return[4,eo(n)];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return[4,this.pr(t)];case 8:return e.sent(),[2]}}))}))}))},t}(),Rr=function(){function t(t,e){this.Sr=t,this.params=e}return t.prototype.Dr=function(t,e){return this.Sr.Cr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Nr=function(t,e){var n=this;if(0===e)return Hn.resolve(kr.ir);var r=new Sr(e);return this.Sr.Ce(t,(function(t){return r.ur(t.sequenceNumber)})).next((function(){return n.Sr.Fr(t,(function(t){return r.ur(t)}))})).next((function(){return r.maxValue}))},t.prototype.Or=function(t,e,n){return this.Sr.Or(t,e,n)},t.prototype.kr=function(t,e){return this.Sr.kr(t,e)},t.prototype.Mr=function(t,e){var n=this;return-1===this.params.wr?(l("LruGarbageCollector","Garbage collection skipped; disabled"),Hn.resolve(Pr)):this.$r(t).next((function(r){return r<n.params.wr?(l("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.wr),Pr):n.Lr(t,e)}))},t.prototype.$r=function(t){return this.Sr.$r(t)},t.prototype.Lr=function(t,e){var n,r,o,u,s,a,c,h=this,p=Date.now();return this.Dr(t,this.params.Er).next((function(e){return e>h.params.Tr?(l("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Tr+" from "+e),r=h.params.Tr):r=e,u=Date.now(),h.Nr(t,r)})).next((function(r){return n=r,s=Date.now(),h.Or(t,n,e)})).next((function(e){return o=e,a=Date.now(),h.kr(t,n)})).next((function(t){return c=Date.now(),f()<=i.a.DEBUG&&l("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(u-p)+"ms\n\tDetermined least recently used "+r+" in "+(s-u)+"ms\n\tRemoved "+o+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-p)+"ms"),Hn.resolve({hr:!0,lr:r,_r:o,dr:t})}))},t}();function Ur(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=qr(e)),e=Cr(t.get(n),e);return qr(e)}function Cr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function qr(t){return t+"\x01\x01"}function Mr(t){var e=t.length;if(m(e>=2),2===e)return m("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),C.U();for(var n=e-2,r=[],i="",o=0;o<e;){var u=t.indexOf("\x01",o);switch((u<0||u>n)&&y(),t.charAt(u+1)){case"\x01":var s=t.substring(o,u),a=void 0;0===i.length?a=s:(a=i+=s,i=""),r.push(a);break;case"\x10":i+=t.substring(o,u),i+="\0";break;case"\x11":i+=t.substring(o,u+1);break;default:y()}o=u+2}return new C(r)}var Fr=function(t){this.Br=t};function Br(t,e){if(e.document)return function(t,e,n){var r=ue(t,e.name),i=ne(e.updateTime),o=new on({mapValue:{fields:e.fields}});return new cn(r,i,o,{hasCommittedMutations:!!n})}(t.Br,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=F.Z(e.noDocument.path),r=Qr(e.noDocument.readTime);return new hn(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=F.Z(e.unknownDocument.path),o=Qr(e.unknownDocument.version);return new fn(i,o)}return y()}function zr(t,e,n){var r=Gr(n),i=e.key.path.F().L();if(e instanceof cn){var o=function(t,e){return{name:oe(t,e.key),fields:e.rn().mapValue.fields,updateTime:$t(t,e.version.v())}}(t.Br,e),u=e.hasCommittedMutations;return new bi(null,null,o,u,r,i)}if(e instanceof hn){var s=e.key.path.L(),a=Wr(e.version),c=e.hasCommittedMutations;return new bi(null,new mi(s,a),null,c,r,i)}if(e instanceof fn){var h=e.key.path.L(),f=Wr(e.version);return new bi(new gi(h,f),null,null,!0,r,i)}return y()}function Gr(t){var e=t.v();return[e.seconds,e.nanoseconds]}function Kr(t){var e=new V(t[0],t[1]);return R.V(e)}function Wr(t){var e=t.v();return new li(e.seconds,e.nanoseconds)}function Qr(t){var e=new V(t.seconds,t.nanoseconds);return R.V(e)}function Hr(t,e){var n=(e.baseMutations||[]).map((function(e){return pe(t.Br,e)})),r=e.mutations.map((function(e){return pe(t.Br,e)})),i=V.fromMillis(e.localWriteTimeMs);return new Or(e.batchId,i,n,r)}function Yr(t){var e,n,r=Qr(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Qr(t.lastLimboFreeSnapshotVersion):R.min();return void 0!==t.query.documents?(m(1===(n=t.query).documents.length),e=In(dn(ae(n.documents[0])))):e=ye(t.query),new Z(e,t.targetId,0,t.lastListenSequenceNumber,r,i,_.fromBase64String(t.resumeToken))}function Jr(t,e){var n,r=Wr(e.nt),i=Wr(e.lastLimboFreeSnapshotVersion);n=Y(e.target)?de(t.Br,e.target):ve(t.Br,e.target);var o=e.resumeToken.toBase64();return new Ii(e.targetId,Q(e.target),r,o,e.sequenceNumber,i,n)}var Xr=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.ki=n,this.qr=r,this.Ur={}}return t.Kr=function(e,n,r,i){return m(""!==e.uid),new t(e.Zs()?e.uid:"",n,r,i)},t.prototype.Qr=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ti(t).rs({index:vi.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Wr=function(t,e,n,r){var i=this,o=ei(t),u=ti(t);return u.add({}).next((function(s){m("number"==typeof s);for(var a=new Or(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return le(t.Br,e)})),i=n.mutations.map((function(e){return le(t.Br,e)}));return new vi(e,n.batchId,n.di.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new ot((function(t,e){return I(t.B(),e.B())})),l=0,p=r;l<p.length;l++){var d=p[l],v=yi.key(i.userId,d.key.path,s);f=f.add(d.key.path.F()),h.push(u.put(c)),h.push(o.put(v,yi.PLACEHOLDER))}return f.forEach((function(e){h.push(i.ki.jr(t,e))})),t.Ni((function(){i.Ur[s]=a.keys()})),Hn.On(h).next((function(){return a}))}))},t.prototype.Gr=function(t,e){var n=this;return ti(t).get(e).next((function(t){return t?(m(t.userId===n.userId),Hr(n.serializer,t)):null}))},t.prototype.zr=function(t,e){var n=this;return this.Ur[e]?Hn.resolve(this.Ur[e]):this.Gr(t,e).next((function(t){if(t){var r=t.keys();return n.Ur[e]=r,r}return null}))},t.prototype.Hr=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ti(t).rs({index:vi.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(m(e.batchId>=r),o=Hr(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Yr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ti(t).rs({index:vi.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.Jr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ti(t).ts(vi.userMutationsIndex,n).next((function(t){return t.map((function(t){return Hr(e.serializer,t)}))}))},t.prototype.$i=function(t,e){var n=this,r=yi.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return ei(t).rs({range:i},(function(r,i,u){var s=r[0],a=r[1],c=r[2],h=Mr(a);if(s===n.userId&&e.path.isEqual(h))return ti(t).get(c).next((function(t){if(!t)throw y();m(t.userId===n.userId),o.push(Hr(n.serializer,t))}));u.done()})).next((function(){return o}))},t.prototype.Ki=function(t,e){var n=this,r=new ot(I),i=[];return e.forEach((function(e){var o=yi.prefixForPath(n.userId,e.path),u=IDBKeyRange.lowerBound(o),s=ei(t).rs({range:u},(function(t,i,o){var u=t[0],s=t[1],a=t[2],c=Mr(s);u===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(s)})),Hn.On(i).next((function(){return n.Xr(t,r)}))},t.prototype.Hi=function(t,e){var n=this,r=e.path,i=r.length+1,o=yi.prefixForPath(this.userId,r),u=IDBKeyRange.lowerBound(o),s=new ot(I);return ei(t).rs({range:u},(function(t,e,o){var u=t[0],a=t[1],c=t[2],h=Mr(a);u===n.userId&&r.M(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.Xr(t,s)}))},t.prototype.Xr=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ti(t).get(e).next((function(t){if(null===t)throw y();m(t.userId===n.userId),r.push(Hr(n.serializer,t))})))})),Hn.On(i).next((function(){return r}))},t.prototype.Zr=function(t,e){var n=this;return $r(t.eo,this.userId,e).next((function(r){return t.Ni((function(){n.no(e.batchId)})),Hn.forEach(r,(function(e){return n.qr.so(t,e)}))}))},t.prototype.no=function(t){delete this.Ur[t]},t.prototype.io=function(t){var e=this;return this.Qr(t).next((function(n){if(!n)return Hn.resolve();var r=IDBKeyRange.lowerBound(yi.prefixForUser(e.userId)),i=[];return ei(t).rs({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Mr(t[1]);i.push(o)}else r.done()})).next((function(){m(0===i.length)}))}))},t.prototype.ro=function(t,e){return Zr(t,this.userId,e)},t.prototype.oo=function(t){var e=this;return ni(t).get(this.userId).next((function(t){return t||new di(e.userId,-1,"")}))},t}();function Zr(t,e,n){var r=yi.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),u=!1;return ei(t).rs({range:o,ss:!0},(function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(u=!0),r.done()})).next((function(){return u}))}function $r(t,e,n){var r=t.store(vi.store),i=t.store(yi.store),o=[],u=IDBKeyRange.only(n.batchId),s=0,a=r.rs({range:u},(function(t,e,n){return s++,n.delete()}));o.push(a.next((function(){m(1===s)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=yi.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Hn.On(o).next((function(){return c}))}function ti(t){return Ui.Kn(t,vi.store)}function ei(t){return Ui.Kn(t,yi.store)}function ni(t){return Ui.Kn(t,di.store)}var ri=function(){function t(t,e){this.serializer=t,this.ki=e}return t.prototype.yi=function(t,e,n){return ui(t).put(si(e),n)},t.prototype.pi=function(t,e){var n=ui(t),r=si(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.ao(t,r)}))},t.prototype.bi=function(t,e){var n=this;return ui(t).get(si(e)).next((function(t){return n.co(t)}))},t.prototype.uo=function(t,e){var n=this;return ui(t).get(si(e)).next((function(t){var e=n.co(t);return e?{ho:e,size:ai(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=ct();return this.lo(t,e,(function(t,e){var i=n.co(e);r=r.ot(t,i)})).next((function(){return r}))},t.prototype._o=function(t,e){var n=this,r=ct(),i=new nt(F.D);return this.lo(t,e,(function(t,e){var o=n.co(e);o?(r=r.ot(t,o),i=i.ot(t,ai(e))):(r=r.ot(t,null),i=i.ot(t,0))})).next((function(){return{fo:r,do:i}}))},t.prototype.lo=function(t,e,n){if(e.P())return Hn.resolve();var r=IDBKeyRange.bound(e.first().path.L(),e.last().path.L()),i=e._t(),o=i.It();return ui(t).rs({range:r},(function(t,e,r){for(var u=F.Z(t);o&&F.D(o,u)<0;)n(o,null),o=i.It();o&&o.isEqual(u)&&(n(o,e),o=i.At()?i.It():null),o?r.Xn(o.path.L()):r.done()})).next((function(){for(;o;)n(o,null),o=i.At()?i.It():null}))},t.prototype.Qi=function(t,e,n){var r=this,i=ft(),o=e.path.length+1,u={};if(n.isEqual(R.min())){var s=e.path.L();u.range=IDBKeyRange.lowerBound(s)}else{var a=e.path.L(),c=Gr(n);u.range=IDBKeyRange.lowerBound([a,c],!0),u.index=bi.collectionReadTimeIndex}return ui(t).rs(u,(function(t,n,u){if(t.length===o){var s=Br(r.serializer,n);e.path.M(s.key.path)?s instanceof cn&&Dn(e,s)&&(i=i.ot(s.key,s)):u.done()}})).next((function(){return i}))},t.prototype.wo=function(t){return new ii(this,!!t&&t.Eo)},t.prototype.To=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return oi(t).get(wi.key).next((function(t){return m(!!t),t}))},t.prototype.ao=function(t,e){return oi(t).put(wi.key,e)},t.prototype.co=function(t){if(t){var e=Br(this.serializer,t);return e instanceof hn&&e.version.isEqual(R.min())?null:e}return null},t}(),ii=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).Io=e,r.Eo=n,r.mo=new L((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(e.c)(n,t),n.prototype.Di=function(t){var e=this,n=[],r=0,i=new ot((function(t,e){return I(t.B(),e.B())}));return this.Ri.forEach((function(o,u){var s=e.mo.get(o);if(u){var a=zr(e.Io.serializer,u,e.readTime);i=i.add(o.path.F());var c=ai(a);r+=c-s,n.push(e.Io.yi(t,o,a))}else if(r-=s,e.Eo){var h=zr(e.Io.serializer,new hn(o,R.min()),e.readTime);n.push(e.Io.yi(t,o,h))}else n.push(e.Io.pi(t,o))})),i.forEach((function(r){n.push(e.Io.ki.jr(t,r))})),n.push(this.Io.updateMetadata(t,r)),Hn.On(n)},n.prototype.vi=function(t,e){var n=this;return this.Io.uo(t,e).next((function(t){return null===t?(n.mo.set(e,0),null):(n.mo.set(e,t.size),t.ho)}))},n.prototype.Si=function(t,e){var n=this;return this.Io._o(t,e).next((function(t){var e=t.fo;return t.do.forEach((function(t,e){n.mo.set(t,e)})),e}))},n}(Tr);function oi(t){return Ui.Kn(t,wi.store)}function ui(t){return Ui.Kn(t,bi.store)}function si(t){return t.path.L()}function ai(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw y();e=t.noDocument}return JSON.stringify(e).length}var ci=function(){function t(){this.Ao=new hi}return t.prototype.jr=function(t,e){return this.Ao.add(e),Hn.resolve()},t.prototype.zi=function(t,e){return Hn.resolve(this.Ao.getEntries(e))},t}(),hi=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.k(),n=t.F(),r=this.index[e]||new ot(C.D),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.k(),n=t.F(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ot(C.D)).L()},t}(),fi=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;m(n<r&&n>=0&&r<=10);var o=new $n("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(pi.store)}(t),function(t){t.createObjectStore(di.store,{keyPath:di.keyPath}),t.createObjectStore(vi.store,{keyPath:vi.keyPath,autoIncrement:!0}).createIndex(vi.userMutationsIndex,vi.userMutationsKeyPath,{unique:!0}),t.createObjectStore(yi.store)}(t),Ti(t),function(t){t.createObjectStore(bi.store)}(t));var u=Hn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ei.store),t.deleteObjectStore(Ii.store),t.deleteObjectStore(Oi.store)}(t),Ti(t)),u=u.next((function(){return function(t){var e=t.store(Oi.store),n=new Oi(0,0,R.min().v(),0);return e.put(Oi.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(t,e){return e.store(vi.store).ts().next((function(n){t.deleteObjectStore(vi.store),t.createObjectStore(vi.store,{keyPath:vi.keyPath,autoIncrement:!0}).createIndex(vi.userMutationsIndex,vi.userMutationsKeyPath,{unique:!0});var r=e.store(vi.store),i=n.map((function(t){return r.put(t)}));return Hn.On(i)}))}(t,o)}))),u=u.next((function(){!function(t){t.createObjectStore(Ni.store,{keyPath:Ni.keyPath})}(t)}))),n<5&&r>=5&&(u=u.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(u=u.next((function(){return function(t){t.createObjectStore(wi.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(u=u.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(u=u.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(u=u.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(bi.store);e.createIndex(bi.readTimeIndex,bi.readTimeIndexPath,{unique:!1}),e.createIndex(bi.collectionReadTimeIndex,bi.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(u=u.next((function(){return i.rewriteCanonicalIds(o)}))),u},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(bi.store).rs((function(t,n){e+=ai(n)})).next((function(){var n=new wi(e);return t.store(wi.store).put(wi.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(di.store),r=t.store(vi.store);return n.ts().next((function(n){return Hn.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.ts(vi.userMutationsIndex,i).next((function(r){return Hn.forEach(r,(function(r){m(r.userId===n.userId);var i=Hr(e.serializer,r);return $r(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Ei.store),n=t.store(bi.store);return t.store(Oi.store).get(Oi.key).next((function(t){var r=[];return n.rs((function(n,i){var o=new C(n),u=function(t){return[0,Ur(t)]}(o);r.push(e.get(u).next((function(n){return n?Hn.resolve():function(n){return e.put(new Ei(0,Ur(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Hn.On(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(_i.store,{keyPath:_i.keyPath});var n=e.store(_i.store),r=new hi,i=function(t){if(r.add(t)){var e=t.k(),i=t.F();return n.put({collectionId:e,parent:Ur(i)})}};return e.store(bi.store).rs({ss:!0},(function(t,e){var n=new C(t);return i(n.F())})).next((function(){return e.store(yi.store).rs({ss:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Mr(n));return i(r.F())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Ii.store);return n.rs((function(t,r){var i=Yr(r),o=Jr(e.serializer,i);return n.put(o)}))},t}(),li=function(t,e){this.seconds=t,this.nanoseconds=e},pi=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};pi.store="owner",pi.key="owner";var di=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};di.store="mutationQueues",di.keyPath="userId";var vi=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};vi.store="mutations",vi.keyPath="batchId",vi.userMutationsIndex="userMutationsIndex",vi.userMutationsKeyPath=["userId","batchId"];var yi=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Ur(e)]},t.key=function(t,e,n){return[t,Ur(e),n]},t}();yi.store="documentMutations",yi.PLACEHOLDER=new yi;var mi=function(t,e){this.path=t,this.readTime=e},gi=function(t,e){this.path=t,this.version=e},bi=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};bi.store="remoteDocuments",bi.readTimeIndex="readTimeIndex",bi.readTimeIndexPath="readTime",bi.collectionReadTimeIndex="collectionReadTimeIndex",bi.collectionReadTimeIndexPath=["parentPath","readTime"];var wi=function(t){this.byteSize=t};wi.store="remoteDocumentGlobal",wi.key="remoteDocumentGlobalKey";var Ii=function(t,e,n,r,i,o,u){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=u};Ii.store="targets",Ii.keyPath="targetId",Ii.queryTargetsIndexName="queryTargetsIndex",Ii.queryTargetsKeyPath=["canonicalId","targetId"];var Ei=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ei.store="targetDocuments",Ei.keyPath=["targetId","path"],Ei.documentTargetsIndex="documentTargetsIndex",Ei.documentTargetsKeyPath=["path","targetId"];var Oi=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Oi.key="targetGlobalKey",Oi.store="targetGlobal";var _i=function(t,e){this.collectionId=t,this.parent=e};function Ti(t){t.createObjectStore(Ei.store,{keyPath:Ei.keyPath}).createIndex(Ei.documentTargetsIndex,Ei.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ii.store,{keyPath:Ii.keyPath}).createIndex(Ii.queryTargetsIndexName,Ii.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Oi.store)}_i.store="collectionParents",_i.keyPath=["collectionId","parent"];var Ni=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ni.store="clientMetadata",Ni.keyPath="clientId";var Ai=Object(e.g)(Object(e.g)(Object(e.g)([di.store,vi.store,yi.store,bi.store,Ii.store,pi.store,Oi.store,Ei.store],[Ni.store]),[wi.store]),[_i.store]),Di=function(){function t(){this.Ro=new hi}return t.prototype.jr=function(t,e){var n=this;if(!this.Ro.has(e)){var r=e.k(),i=e.F();t.Ni((function(){n.Ro.add(e)}));var o={collectionId:r,parent:Ur(i)};return ji(t).put(o)}return Hn.resolve()},t.prototype.zi=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[O(e),""],!1,!0);return ji(t).ts(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Mr(o.parent))}return n}))},t}();function ji(t){return Ui.Kn(t,_i.store)}var ki=function(){function t(t){this.Po=t}return t.prototype.next=function(){return this.Po+=2,this.Po},t.yo=function(){return new t(0)},t.Vo=function(){return new t(-1)},t}(),xi=function(){function t(t,e){this.qr=t,this.serializer=e}return t.prototype.po=function(t){var e=this;return this.bo(t).next((function(n){var r=new ki(n.highestTargetId);return n.highestTargetId=r.next(),e.vo(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.So=function(t){return this.bo(t).next((function(t){return R.V(new V(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Do=function(t){return this.bo(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Co=function(t,e,n){var r=this;return this.bo(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.v()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.vo(t,i)}))},t.prototype.No=function(t,e){var n=this;return this.xo(t,e).next((function(){return n.bo(t).next((function(r){return r.targetCount+=1,n.Fo(e,r),n.vo(t,r)}))}))},t.prototype.Oo=function(t,e){return this.xo(t,e)},t.prototype.ko=function(t,e){var n=this;return this.Mo(t,e.targetId).next((function(){return Si(t).delete(e.targetId)})).next((function(){return n.bo(t)})).next((function(e){return m(e.targetCount>0),e.targetCount-=1,n.vo(t,e)}))},t.prototype.Or=function(t,e,n){var r=this,i=0,o=[];return Si(t).rs((function(u,s){var a=Yr(s);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.ko(t,a)))})).next((function(){return Hn.On(o)})).next((function(){return i}))},t.prototype.Ce=function(t,e){return Si(t).rs((function(t,n){var r=Yr(n);e(r)}))},t.prototype.bo=function(t){return Pi(t).get(Oi.key).next((function(t){return m(null!==t),t}))},t.prototype.vo=function(t,e){return Pi(t).put(Oi.key,e)},t.prototype.xo=function(t,e){return Si(t).put(Jr(this.serializer,e))},t.prototype.Fo=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.$o=function(t){return this.bo(t).next((function(t){return t.targetCount}))},t.prototype.Lo=function(t,e){var n=Q(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Si(t).rs({range:r,index:Ii.queryTargetsIndexName},(function(t,n,r){var o=Yr(n);H(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Bo=function(t,e,n){var r=this,i=[],o=Li(t);return e.forEach((function(e){var u=Ur(e.path);i.push(o.put(new Ei(n,u))),i.push(r.qr.qo(t,n,e))})),Hn.On(i)},t.prototype.Uo=function(t,e,n){var r=this,i=Li(t);return Hn.forEach(e,(function(e){var o=Ur(e.path);return Hn.On([i.delete([n,o]),r.qr.Ko(t,n,e)])}))},t.prototype.Mo=function(t,e){var n=Li(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Qo=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Li(t),i=dt();return r.rs({range:n,ss:!0},(function(t,e,n){var r=Mr(t[1]),o=new F(r);i=i.add(o)})).next((function(){return i}))},t.prototype.ro=function(t,e){var n=Ur(e.path),r=IDBKeyRange.bound([n],[O(n)],!1,!0),i=0;return Li(t).rs({index:Ei.documentTargetsIndex,ss:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Ue=function(t,e){return Si(t).get(e).next((function(t){return t?Yr(t):null}))},t}();function Si(t){return Ui.Kn(t,Ii.store)}function Pi(t){return Ui.Kn(t,Oi.store)}function Li(t){return Ui.Kn(t,Ei.store)}var Vi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ri=function(t){function n(e,n){var r=this;return(r=t.call(this)||this).eo=e,r.Wo=n,r}return Object(e.c)(n,t),n}(Ar),Ui=function(){function t(e,n,r,i,o,u,s,h,f,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.fn=o,this.window=u,this.document=s,this.jo=f,this.Go=l,this.zo=null,this.Ho=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Yo=null,this.inForeground=!1,this.Jo=null,this.Xo=null,this.Zo=Number.NEGATIVE_INFINITY,this.ta=function(t){return Promise.resolve()},!t.Ln())throw new c(a.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.qr=new Mi(this,i),this.ea=n+"main",this.serializer=new Fr(h),this.na=new Yn(this.ea,10,new fi(this.serializer)),this.sa=new xi(this.qr,this.serializer),this.ki=new Di,this.Fi=function(t,e){return new ri(t,e)}(this.serializer,this.ki),this.window&&this.window.localStorage?this.ia=this.window.localStorage:(this.ia=null,!1===l&&p("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.Kn=function(t,e){if(t instanceof Ri)return Yn.Kn(t.eo,e);throw y()},t.prototype.start=function(){var t=this;return this.ra().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new c(a.FAILED_PRECONDITION,Vi);return t.oa(),t.aa(),t.ca(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.sa.Do(e)}))})).then((function(e){t.zo=new kr(e,t.jo)})).then((function(){t.Ho=!0})).catch((function(e){return t.na&&t.na.close(),Promise.reject(e)}))},t.prototype.ua=function(t){var n=this;return this.ta=function(r){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return this.br?[2,t(r)]:[2]}))}))},t(this.isPrimary)},t.prototype.ha=function(t){var n=this;this.na.jn((function(r){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return null===r.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.la=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.fn.ws((function(){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.br?[4,this.ra()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.ra=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return qi(e).put(new Ni(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t._a(e).next((function(e){e||(t.isPrimary=!1,t.fn.Cs((function(){return t.ta(!1)})))}))})).next((function(){return t.fa(e)})).next((function(n){return t.isPrimary&&!n?t.da(e).next((function(){return!1})):!!n&&t.wa(e).next((function(){return!0}))}))})).catch((function(e){if(Zn(e))return l("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return l("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.fn.Cs((function(){return t.ta(e)})),t.isPrimary=e}))},t.prototype._a=function(t){var e=this;return Ci(t).get(pi.key).next((function(t){return Hn.resolve(e.Ea(t))}))},t.prototype.Ta=function(t){return qi(t).delete(this.clientId)},t.prototype.Ia=function(){return Object(e.b)(this,void 0,void 0,(function(){var n,r,i,o,u=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return!this.isPrimary||this.ma(this.Zo,18e5)?[3,2]:(this.Zo=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=t.Kn(e,Ni.store);return n.ts().next((function(t){var e=u.Aa(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return Hn.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(n=e.sent(),this.ia)for(r=0,i=n;r<i.length;r++)o=i[r],this.ia.removeItem(this.Ra(o.clientId));e.label=2;case 2:return[2]}}))}))},t.prototype.ca=function(){var t=this;this.Xo=this.fn.yn("client_metadata_refresh",4e3,(function(){return t.ra().then((function(){return t.Ia()})).then((function(){return t.ca()}))}))},t.prototype.Ea=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.fa=function(t){var e=this;return this.Go?Hn.resolve(!0):Ci(t).get(pi.key).next((function(n){if(null!==n&&e.ma(n.leaseTimestampMs,5e3)&&!e.Pa(n.ownerId)){if(e.Ea(n)&&e.networkEnabled)return!0;if(!e.Ea(n)){if(!n.allowTabSynchronization)throw new c(a.FAILED_PRECONDITION,Vi);return!1}}return!(!e.networkEnabled||!e.inForeground)||qi(t).ts().next((function(t){return void 0===e.Aa(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&l("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.ga=function(){return Object(e.b)(this,void 0,void 0,(function(){var t=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.Ho=!1,this.ya(),this.Xo&&(this.Xo.cancel(),this.Xo=null),this.Va(),this.pa(),[4,this.na.runTransaction("shutdown","readwrite",[pi.store,Ni.store],(function(e){var n=new Ri(e,kr.ir);return t.da(n).next((function(){return t.Ta(n)}))}))];case 1:return e.sent(),this.na.close(),this.ba(),[2]}}))}))},t.prototype.Aa=function(t,e){var n=this;return t.filter((function(t){return n.ma(t.updateTimeMs,e)&&!n.Pa(t.clientId)}))},t.prototype.va=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return qi(e).ts().next((function(e){return t.Aa(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),t.prototype.Sa=function(t){return Xr.Kr(t,this.serializer,this.ki,this.qr)},t.prototype.Da=function(){return this.sa},t.prototype.Ca=function(){return this.Fi},t.prototype.Na=function(){return this.ki},t.prototype.runTransaction=function(t,e,n){var r=this;l("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.na.runTransaction(t,o,Ai,(function(o){return i=new Ri(o,r.zo?r.zo.next():kr.ir),"readwrite-primary"===e?r._a(i).next((function(t){return!!t||r.fa(i)})).next((function(e){if(!e)throw p("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.fn.Cs((function(){return r.ta(!1)})),new c(a.FAILED_PRECONDITION,Nr);return n(i)})).next((function(t){return r.wa(i).next((function(){return t}))})):r.xa(i).next((function(){return n(i)}))})).then((function(t){return i.xi(),t}))},t.prototype.xa=function(t){var e=this;return Ci(t).get(pi.key).next((function(t){if(null!==t&&e.ma(t.leaseTimestampMs,5e3)&&!e.Pa(t.ownerId)&&!e.Ea(t)&&!(e.Go||e.allowTabSynchronization&&t.allowTabSynchronization))throw new c(a.FAILED_PRECONDITION,Vi)}))},t.prototype.wa=function(t){var e=new pi(this.clientId,this.allowTabSynchronization,Date.now());return Ci(t).put(pi.key,e)},t.Ln=function(){return Yn.Ln()},t.prototype.da=function(t){var e=this,n=Ci(t);return n.get(pi.key).next((function(t){return e.Ea(t)?(l("IndexedDbPersistence","Releasing primary lease."),n.delete(pi.key)):Hn.resolve()}))},t.prototype.ma=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(p("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.oa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Jo=function(){t.fn.ws((function(){return t.inForeground="visible"===t.document.visibilityState,t.ra()}))},this.document.addEventListener("visibilitychange",this.Jo),this.inForeground="visible"===this.document.visibilityState)},t.prototype.Va=function(){this.Jo&&(this.document.removeEventListener("visibilitychange",this.Jo),this.Jo=null)},t.prototype.aa=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Yo=function(){e.ya(),e.fn.ws((function(){return e.ga()}))},this.window.addEventListener("unload",this.Yo))},t.prototype.pa=function(){this.Yo&&(this.window.removeEventListener("unload",this.Yo),this.Yo=null)},t.prototype.Pa=function(t){var e;try{var n=null!==(null===(e=this.ia)||void 0===e?void 0:e.getItem(this.Ra(t)));return l("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return p("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.ya=function(){if(this.ia)try{this.ia.setItem(this.Ra(this.clientId),String(Date.now()))}catch(t){p("Failed to set zombie client id.",t)}},t.prototype.ba=function(){if(this.ia)try{this.ia.removeItem(this.Ra(this.clientId))}catch(t){}},t.prototype.Ra=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Ci(t){return Ui.Kn(t,pi.store)}function qi(t){return Ui.Kn(t,Ni.store)}var Mi=function(){function t(t,e){this.db=t,this.gr=new Rr(this,e)}return t.prototype.Cr=function(t){var e=this.Fa(t);return this.db.Da().$o(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Fa=function(t){var e=0;return this.Fr(t,(function(t){e++})).next((function(){return e}))},t.prototype.Ce=function(t,e){return this.db.Da().Ce(t,e)},t.prototype.Fr=function(t,e){return this.Oa(t,(function(t,n){return e(n)}))},t.prototype.qo=function(t,e,n){return Fi(t,n)},t.prototype.Ko=function(t,e,n){return Fi(t,n)},t.prototype.Or=function(t,e,n){return this.db.Da().Or(t,e,n)},t.prototype.so=function(t,e){return Fi(t,e)},t.prototype.ka=function(t,e){return function(t,e){var n=!1;return ni(t).os((function(r){return Zr(t,r,e).next((function(t){return t&&(n=!0),Hn.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.kr=function(t,e){var n=this,r=this.db.Ca().wo(),i=[],o=0;return this.Oa(t,(function(u,s){if(s<=e){var a=n.ka(t,u).next((function(e){if(!e)return o++,r.bi(t,u).next((function(){return r.pi(u),Li(t).delete([0,Ur(u.path)])}))}));i.push(a)}})).next((function(){return Hn.On(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.st(t.Wo);return this.db.Da().Oo(t,n)},t.prototype.Ma=function(t,e){return Fi(t,e)},t.prototype.Oa=function(t,e){var n,r=Li(t),i=kr.ir;return r.rs({index:Ei.documentTargetsIndex},(function(t,r){var o=t[0],u=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==kr.ir&&e(new F(Mr(n)),i),i=s,n=u):i=kr.ir})).next((function(){i!==kr.ir&&e(new F(Mr(n)),i)}))},t.prototype.$r=function(t){return this.db.Ca().To(t)},t}();function Fi(t,e){return Li(t).put(function(t,e){return new Ei(0,Ur(t.path),e)}(e,t.Wo))}function Bi(t,e){var n=t.projectId;return t.I||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var zi=function(){function t(t,e,n){this.persistence=t,this.$a=e,this.La=new nt(I),this.Ba=new L((function(t){return Q(t)}),H),this.qa=R.min(),this.Oi=t.Sa(n),this.Ua=t.Ca(),this.sa=t.Da(),this.Ka=new Dr(this.Ua,this.Oi,this.persistence.Na()),this.$a.Qa(this.Ka)}return t.prototype.vr=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.Mr(n,e.La)}))},t}();function Gi(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=g(t),i=r.Oi,o=r.Ka,[4,r.persistence.runTransaction("Handle user change","readonly",(function(t){var e;return r.Oi.Jr(t).next((function(u){return e=u,i=r.persistence.Sa(n),o=new Dr(r.Ua,i,r.persistence.Na()),i.Jr(t)})).next((function(n){for(var r=[],i=[],u=dt(),s=0,a=e;s<a.length;s++){var c=a[s];r.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];u=u.add(l.key)}}for(var p=0,d=n;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,m=v.mutations;y<m.length;y++){var g=m[y];u=u.add(g.key)}}return o.qi(t,u).next((function(t){return{Wa:t,ja:r,Ga:i}}))}))}))];case 1:return u=e.sent(),[2,(r.Oi=i,r.Ka=o,r.$a.Qa(r.Ka),u)]}}))}))}function Ki(t,e){var n=g(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Ua.wo({Eo:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),u=Hn.resolve();return o.forEach((function(t){u=u.next((function(){return r.bi(e,t)})).next((function(e){var o=e,u=n.Ai.get(t);m(null!==u),(!o||o.version.u(u)<0)&&(o=i.wi(t,o,n))&&r.yi(o,n.mi)}))})),u.next((function(){return t.Oi.Zr(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Oi.io(t)})).next((function(){return n.Ka.qi(t,r)}))}))}function Wi(t){var e=g(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.sa.So(t)}))}function Qi(t,e){var n=g(t),r=e.nt,i=n.La;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Ua.wo({Eo:!0});i=n.La;var u=[];e.zt.forEach((function(e,o){var s=i.get(o);if(s){u.push(n.sa.Uo(t,e.se,o).next((function(){return n.sa.Bo(t,e.ee,o)})));var a=e.resumeToken;if(a.o()>0){var c=s.it(a,r).st(t.Wo);i=i.ot(o,c),function(t,e,n){return m(e.resumeToken.o()>0),0===t.resumeToken.o()||e.nt.p()-t.nt.p()>=3e8||n.ee.size+n.ne.size+n.se.size>0}(s,c,e)&&u.push(n.sa.Oo(t,c))}}}));var s=at(),a=dt();if(e.Yt.forEach((function(t,e){a=a.add(t)})),u.push(o.getEntries(t,a).next((function(i){e.Yt.forEach((function(a,c){var h=i.get(a);c instanceof hn&&c.version.isEqual(R.min())?(o.pi(a,r),s=s.ot(a,c)):null==h||c.version.u(h.version)>0||0===c.version.u(h.version)&&h.hasPendingWrites?(o.yi(c,r),s=s.ot(a,c)):l("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",c.version),e.Jt.has(a)&&u.push(n.persistence.qr.Ma(t,a))}))}))),!r.isEqual(R.min())){var c=n.sa.So(t).next((function(e){return n.sa.Co(t,t.Wo,r)}));u.push(c)}return Hn.On(u).next((function(){return o.apply(t)})).next((function(){return n.Ka.Ui(t,s)}))})).then((function(t){return n.La=i,t}))}function Hi(t,e){var n=g(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Oi.Hr(t,e)}))}function Yi(t,e){var n=g(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.sa.Lo(t,e).next((function(i){return i?(r=i,Hn.resolve(r)):n.sa.po(t).next((function(i){return r=new Z(e,i,0,t.Wo),n.sa.No(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.La.get(t.targetId);return(null===r||t.nt.u(r.nt)>0)&&(n.La=n.La.ot(t.targetId,t),n.Ba.set(e,t.targetId)),t}))}function Ji(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:i=g(t),o=i.La.get(n),u=r?"readwrite":"readwrite-primary",e.label=1;case 1:return e.trys.push([1,4,,5]),r?[3,3]:[4,i.persistence.runTransaction("Release target",u,(function(t){return i.persistence.qr.removeTarget(t,o)}))];case 2:e.sent(),e.label=3;case 3:return[3,5];case 4:if(!Zn(s=e.sent()))throw s;return l("LocalStore","Failed to update sequence numbers for target "+n+": "+s),[3,5];case 5:return i.La=i.La.remove(n),i.Ba.delete(o.target),[2]}}))}))}function Xi(t,e,n){var r=g(t),i=R.min(),o=dt();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=g(t),i=r.Ba.get(n);return void 0!==i?Hn.resolve(r.La.get(i)):r.sa.Lo(e,n)}(r,t,In(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.sa.Qo(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.$a.Qi(t,e,n?i:R.min(),n?o:dt())})).next((function(t){return{documents:t,za:o}}))}))}function Zi(t,e){var n=g(t),r=g(n.sa),i=n.La.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Ue(t,e).next((function(t){return t?t.target:null}))}))}function $i(t){var e=g(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=g(t),i=at(),o=Gr(n),u=ui(e),s=IDBKeyRange.lowerBound(o,!0);return u.rs({index:bi.readTimeIndex,range:s},(function(t,e){var n=Br(r.serializer,e);i=i.ot(n.key,n),o=e.readTime})).next((function(){return{Ha:i,readTime:Kr(o)}}))}(e.Ua,t,e.qa)})).then((function(t){var n=t.Ha,r=t.readTime;return e.qa=r,n}))}function to(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){return[2,(n=g(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=ui(t),n=R.min();return e.rs({index:bi.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Kr(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){n.qa=t}))]}))}))}function eo(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){if(t.code!==a.FAILED_PRECONDITION||t.message!==Nr)throw t;return l("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var no=function(){function t(t,e,n,r,i,o){this.fn=t,this.Ya=n,this.Ja=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tc=null,this.stream=null,this.ys=new Qn(t,e)}return t.prototype.ec=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.nc=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.sc()},t.prototype.stop=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.ec()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.ic=function(){this.state=0,this.ys.reset()},t.prototype.rc=function(){var t=this;this.nc()&&null===this.tc&&(this.tc=this.fn.yn(this.Ya,6e4,(function(){return t.oc()})))},t.prototype.ac=function(t){this.cc(),this.stream.send(t)},t.prototype.oc=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return this.nc()?[2,this.close(0)]:[2]}))}))},t.prototype.cc=function(){this.tc&&(this.tc.cancel(),this.tc=null)},t.prototype.close=function(t,n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.cc(),this.ys.cancel(),this.Za++,3!==t?this.ys.reset():n&&n.code===a.RESOURCE_EXHAUSTED?(p(n.toString()),p("Using maximum backoff delay to prevent overloading the backend."),this.ys.Rn()):n&&n.code===a.UNAUTHENTICATED&&this.Xa.ri(),null!==this.stream&&(this.uc(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.hc(n)];case 1:return e.sent(),[2]}}))}))},t.prototype.uc=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.lc(this.Za),n=this.Za;this.Xa.getToken().then((function(e){t.Za===n&&t._c(e)}),(function(n){e((function(){var e=new c(a.UNKNOWN,"Fetching auth token failed: "+n.message);return t.fc(e)}))}))},t.prototype._c=function(t){var e=this,n=this.lc(this.Za);this.stream=this.dc(t),this.stream.wc((function(){n((function(){return e.state=2,e.listener.wc()}))})),this.stream.hc((function(t){n((function(){return e.fc(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.sc=function(){var t=this;this.state=4,this.ys.Pn((function(){return Object(e.b)(t,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.fc=function(t){return l("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.lc=function(t){var e=this;return function(n){e.fn.ws((function(){return e.Za===t?n():(l("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),ro=function(t){function n(e,n,r,i,o){var u=this;return(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).serializer=i,u}return Object(e.c)(n,t),n.prototype.dc=function(t){return this.Ja.Ec("Listen",t)},n.prototype.onMessage=function(t){this.ys.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:y()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Ke?(m(void 0===e||"string"==typeof e),_.fromBase64String(e||"")):(m(void 0===e||e instanceof Uint8Array),_.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),u=e.targetChange.cause,s=u&&function(t){var e=void 0===t.code?a.UNKNOWN:et(t.code);return new c(e,t.message||"")}(u);n=new _t(r,i,o,s||null)}else if("documentChange"in e){e.documentChange;var h=e.documentChange;h.document,h.document.name,h.document.updateTime;var f=ue(t,h.document.name),l=ne(h.document.updateTime),p=new on({mapValue:{fields:h.document.fields}}),d=new cn(f,l,p,{}),v=h.targetIds||[],g=h.removedTargetIds||[];n=new Et(v,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;var b=e.documentDelete;b.document;var w=ue(t,b.document),I=b.readTime?ne(b.readTime):R.min(),E=new hn(w,I),O=b.removedTargetIds||[];n=new Et([],O,E.key,E)}else if("documentRemove"in e){e.documentRemove;var T=e.documentRemove;T.document;var N=ue(t,T.document),A=T.removedTargetIds||[];n=new Et([],A,N,null)}else{if(!("filter"in e))return y();e.filter;var D=e.filter;D.targetId;var j=D.count||0,k=new $(j),x=D.targetId;n=new Ot(x,k)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return R.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?R.min():e.readTime?ne(e.readTime):R.min()}(t);return this.listener.Tc(e,n)},n.prototype.Ic=function(t){var e={};e.database=ce(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=Y(r)?{documents:de(t,r)}:{query:ve(t,r)}).targetId=e.targetId,e.resumeToken.o()>0&&(n.resumeToken=te(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return y()}}(0,e.et);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.ac(e)},n.prototype.mc=function(t){var e={};e.database=ce(this.serializer),e.removeTarget=t,this.ac(e)},n}(no),io=function(t){function n(e,n,r,i,o){var u=this;return(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).serializer=i,u.Ac=!1,u}return Object(e.c)(n,t),Object.defineProperty(n.prototype,"Rc",{get:function(){return this.Ac},enumerable:!1,configurable:!0}),n.prototype.start=function(){this.Ac=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},n.prototype.uc=function(){this.Ac&&this.Pc([])},n.prototype.dc=function(t){return this.Ja.Ec("Write",t)},n.prototype.onMessage=function(t){if(m(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Ac){this.ys.reset();var e=function(t,e){return t&&t.length>0?(m(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?ne(t.updateTime):ne(e);n.isEqual(R.min())&&(n=ne(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Fe(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=ne(t.commitTime);return this.listener.gc(n,e)}return m(!t.writeResults||0===t.writeResults.length),this.Ac=!0,this.listener.yc()},n.prototype.Vc=function(){var t={};t.database=ce(this.serializer),this.ac(t)},n.prototype.Pc=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return le(e.serializer,t)}))};this.ac(n)},n}(no),oo=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Ja=n,i.serializer=r,i.bc=!1,i}return Object(e.c)(n,t),n.prototype.vc=function(){if(this.bc)throw new c(a.FAILED_PRECONDITION,"The client has already been terminated.")},n.prototype.Sc=function(t,e,n){var r=this;return this.vc(),this.credentials.getToken().then((function(i){return r.Ja.Sc(t,e,n,i)})).catch((function(t){throw t.code===a.UNAUTHENTICATED&&r.credentials.ri(),t}))},n.prototype.Dc=function(t,e,n){var r=this;return this.vc(),this.credentials.getToken().then((function(i){return r.Ja.Dc(t,e,n,i)})).catch((function(t){throw t.code===a.UNAUTHENTICATED&&r.credentials.ri(),t}))},n.prototype.terminate=function(){this.bc=!1},n}((function(){})),uo=function(){function t(t,e){this.cs=t,this.Cc=e,this.state="Unknown",this.Nc=0,this.xc=null,this.Fc=!0}return t.prototype.Oc=function(){var t=this;0===this.Nc&&(this.kc("Unknown"),this.xc=this.cs.yn("online_state_timeout",1e4,(function(){return t.xc=null,t.Mc("Backend didn't respond within 10 seconds."),t.kc("Offline"),Promise.resolve()})))},t.prototype.$c=function(t){"Online"===this.state?this.kc("Unknown"):(this.Nc++,this.Nc>=1&&(this.Lc(),this.Mc("Connection failed 1 times. Most recent error: "+t.toString()),this.kc("Offline")))},t.prototype.set=function(t){this.Lc(),this.Nc=0,"Online"===t&&(this.Fc=!1),this.kc(t)},t.prototype.kc=function(t){t!==this.state&&(this.state=t,this.Cc(t))},t.prototype.Mc=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fc?(p(e),this.Fc=!1):l("OnlineStateTracker",e)},t.prototype.Lc=function(){null!==this.xc&&(this.xc.cancel(),this.xc=null)},t}(),so=function(t,n,r,i,o){var u=this;this.Bc=t,this.qc=n,this.cs=r,this.Uc={},this.Kc=[],this.Qc=new Map,this.Wc=new Set,this.jc=[],this.Gc=o,this.Gc.zc((function(t){r.ws((function(){return Object(e.b)(u,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return mo(this)?(l("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(n=g(t)).Wc.add(4),[4,co(n)];case 1:return e.sent(),n.Hc.set("Unknown"),n.Wc.delete(4),[4,ao(n)];case 2:return e.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Hc=new uo(r,i)};function ao(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:if(!mo(t))return[3,4];n=0,r=t.jc,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!0)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))}function co(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:n=0,r=t.jc,e.label=1;case 1:return n<r.length?[4,(0,r[n])(!1)]:[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))}function ho(t,e){var n=g(t);n.Qc.has(e.targetId)||(n.Qc.set(e.targetId,e),yo(n)?vo(n):So(n).nc()&&lo(n,e))}function fo(t,e){var n=g(t),r=So(n);n.Qc.delete(e),r.nc()&&po(n,e),0===n.Qc.size&&(r.nc()?r.rc():mo(n)&&n.Hc.set("Unknown"))}function lo(t,e){t.Yc.me(e.targetId),So(t).Ic(e)}function po(t,e){t.Yc.me(e),So(t).mc(e)}function vo(t){t.Yc=new Nt({qe:function(e){return t.Uc.qe(e)},Ue:function(e){return t.Qc.get(e)||null}}),So(t).start(),t.Hc.Oc()}function yo(t){return mo(t)&&!So(t).ec()&&t.Qc.size>0}function mo(t){return 0===g(t).Wc.size}function go(t){t.Yc=void 0}function bo(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return t.Qc.forEach((function(e,n){lo(t,e)})),[2]}))}))}function wo(t,n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return go(t),yo(t)?(t.Hc.$c(n),vo(t)):t.Hc.set("Unknown"),[2]}))}))}function Io(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u;return Object(e.d)(this,(function(s){switch(s.label){case 0:if(t.Hc.set("Online"),!(n instanceof _t&&2===n.state&&n.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=n.cause,i=0,o=n.targetIds,e.label=1;case 1:return i<o.length?(u=o[i],t.Qc.has(u)?[4,t.Uc.Jc(u,r)]:[3,3]):[3,5];case 2:e.sent(),t.Qc.delete(u),t.Yc.removeTarget(u),e.label=3;case 3:e.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,n)];case 2:return s.sent(),[3,5];case 3:return i=s.sent(),l("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),i),[4,Eo(t,i)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(n instanceof Et?t.Yc.be(n):n instanceof Ot?t.Yc.Oe(n):t.Yc.De(n),r.isEqual(R.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Wi(t.Bc)];case 8:return o=s.sent(),r.u(o)>=0?[4,function(t,e){var n=t.Yc.$e(e);return n.zt.forEach((function(n,r){if(n.resumeToken.o()>0){var i=t.Qc.get(r);i&&t.Qc.set(r,i.it(n.resumeToken,e))}})),n.Ht.forEach((function(e){var n=t.Qc.get(e);if(n){t.Qc.set(e,n.it(_.h,n.nt)),po(t,e);var r=new Z(n.target,e,1,n.sequenceNumber);lo(t,r)}})),t.Uc.Xc(n)}(t,r)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return l("RemoteStore","Failed to raise snapshot:",u=s.sent()),[4,Eo(t,u)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Eo(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i=this;return Object(e.d)(this,(function(o){switch(o.label){case 0:if(!Zn(n))throw n;return t.Wc.add(1),[4,co(t)];case 1:return o.sent(),t.Hc.set("Offline"),r||(r=function(){return Wi(t.Bc)}),t.cs.Cs((function(){return Object(e.b)(i,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return l("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return e.sent(),t.Wc.delete(1),[4,ao(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Oo(t,e){return e().catch((function(n){return Eo(t,n,e)}))}function _o(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r,i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:n=g(t),r=Po(n),i=n.Kc.length>0?n.Kc[n.Kc.length-1].batchId:-1,e.label=1;case 1:if(!function(t){return mo(t)&&t.Kc.length<10}(n))return[3,7];e.label=2;case 2:return e.trys.push([2,4,,6]),[4,Hi(n.Bc,i)];case 3:return null===(o=e.sent())?(0===n.Kc.length&&r.rc(),[3,7]):(i=o.batchId,function(t,e){t.Kc.push(e);var n=Po(t);n.nc()&&n.Rc&&n.Pc(e.mutations)}(n,o),[3,6]);case 4:return u=e.sent(),[4,Eo(n,u)];case 5:return e.sent(),[3,6];case 6:return[3,1];case 7:return To(n)&&No(n),[2]}}))}))}function To(t){return mo(t)&&!Po(t).ec()&&t.Kc.length>0}function No(t){Po(t).start()}function Ao(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return Po(t).Vc(),[2]}))}))}function Do(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(e.d)(this,(function(e){for(n=Po(t),r=0,i=t.Kc;r<i.length;r++)o=i[r],n.Pc(o.mutations);return[2]}))}))}function jo(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return i=t.Kc.shift(),o=_r.from(i,n,r),[4,Oo(t,(function(){return t.Uc.Zc(o)}))];case 1:return e.sent(),[4,_o(t)];case 2:return e.sent(),[2]}}))}))}function ko(t,n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(r){switch(r.label){case 0:return n&&Po(t).Rc?[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return tt(i=n.code)&&i!==a.ABORTED?(r=t.Kc.shift(),Po(t).ic(),[4,Oo(t,(function(){return t.Uc.tu(r.batchId,n)}))]):[3,3];case 1:return e.sent(),[4,_o(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}(t,n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return To(t)&&No(t),[2]}}))}))}function xo(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=g(t),n?(r.Wc.delete(2),[4,ao(r)]):[3,2];case 1:return e.sent(),[3,5];case 2:return n?[3,4]:(r.Wc.add(2),[4,co(r)]);case 3:e.sent(),r.Hc.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))}function So(t){var n=this;return t.eu||(t.eu=function(t,e,n){var r=g(t);return r.vc(),new ro(e,r.Ja,r.credentials,r.serializer,n)}(t.qc,t.cs,{wc:bo.bind(null,t),hc:wo.bind(null,t),Tc:Io.bind(null,t)}),t.jc.push((function(r){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return r?(t.eu.ic(),yo(t)?vo(t):t.Hc.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.eu.stop()];case 2:e.sent(),go(t),e.label=3;case 3:return[2]}}))}))}))),t.eu}function Po(t){var n=this;return t.nu||(t.nu=function(t,e,n){var r=g(t);return r.vc(),new io(e,r.Ja,r.credentials,r.serializer,n)}(t.qc,t.cs,{wc:Ao.bind(null,t),hc:ko.bind(null,t),yc:Do.bind(null,t),gc:jo.bind(null,t)}),t.jc.push((function(r){return Object(e.b)(n,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return r?(t.nu.ic(),[4,_o(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.nu.stop()];case 3:e.sent(),t.Kc.length>0&&(l("RemoteStore","Stopping write stream with "+t.Kc.length+" pending writes"),t.Kc=[]),e.label=4;case 4:return[2]}}))}))}))),t.nu}var Lo=function(){function t(){this.su=new ot(Vo.iu),this.ru=new ot(Vo.ou)}return t.prototype.P=function(){return this.su.P()},t.prototype.qo=function(t,e){var n=new Vo(t,e);this.su=this.su.add(n),this.ru=this.ru.add(n)},t.prototype.au=function(t,e){var n=this;t.forEach((function(t){return n.qo(t,e)}))},t.prototype.Ko=function(t,e){this.cu(new Vo(t,e))},t.prototype.uu=function(t,e){var n=this;t.forEach((function(t){return n.Ko(t,e)}))},t.prototype.hu=function(t){var e=this,n=new F(new C([])),r=new Vo(n,t),i=new Vo(n,t+1),o=[];return this.ru.xt([r,i],(function(t){e.cu(t),o.push(t.key)})),o},t.prototype.lu=function(){var t=this;this.su.forEach((function(e){return t.cu(e)}))},t.prototype.cu=function(t){this.su=this.su.delete(t),this.ru=this.ru.delete(t)},t.prototype._u=function(t){var e=new F(new C([])),n=new Vo(e,t),r=new Vo(e,t+1),i=dt();return this.ru.xt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.ro=function(t){var e=new Vo(t,0),n=this.su.Ot(e);return null!==n&&t.isEqual(n.key)},t}(),Vo=function(){function t(t,e){this.key=t,this.fu=e}return t.iu=function(t,e){return F.D(t.key,e.key)||I(t.fu,e.fu)},t.ou=function(t,e){return I(t.fu,e.fu)||F.D(t.key,e.key)},t}();function Ro(t,e){return"firestore_clients_"+t+"_"+e}function Uo(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Zs()&&(r+="_"+e.uid),r}function Co(t,e){return"firestore_targets_"+t+"_"+e}var qo=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.du=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),u=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(u=new c(i.error.code,i.error.message)),o?new t(e,n,i.state,u):(p("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Mo=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.du=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new c(r.error.code,r.error.message)),i?new t(e,r.state,o):(p("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.wu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Fo=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.du=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=yt(),u=0;i&&u<r.activeTargetIds.length;++u)i=G(r.activeTargetIds[u]),o=o.add(r.activeTargetIds[u]);return i?new t(e,o):(p("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Bo=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.du=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(p("SharedClientState","Failed to parse online state: "+e),null)},t}(),zo=function(){function t(){this.activeTargetIds=yt()}return t.prototype.Eu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Tu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.wu=function(){var t={activeTargetIds:this.activeTargetIds.L(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Go=function(){function t(t,e,n,r,i){this.window=t,this.fn=e,this.persistenceKey=n,this.Iu=r,this.mu=null,this.Cc=null,this.tr=null,this.Au=this.Ru.bind(this),this.Pu=new nt(I),this.br=!1,this.gu=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.yu=Ro(this.persistenceKey,this.Iu),this.Vu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Pu=this.Pu.ot(this.Iu,new zo),this.pu=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.bu=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.vu=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Su=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Au)}return t.Ln=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(e.b)(this,void 0,void 0,(function(){var t,n,r,i,o,u,s,a,c,h,f,l=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,this.mu.va()];case 1:for(t=e.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Iu&&(o=this.getItem(Ro(this.persistenceKey,i)))&&(u=Fo.du(i,o))&&(this.Pu=this.Pu.ot(u.clientId,u));for(this.Du(),(s=this.storage.getItem(this.Su))&&(a=this.Cu(s))&&this.Nu(a),c=0,h=this.gu;c<h.length;c++)f=h[c],this.Ru(f);return this.gu=[],this.window.addEventListener("unload",(function(){return l.ga()})),this.br=!0,[2]}}))}))},t.prototype.sr=function(t){this.setItem(this.Vu,JSON.stringify(t))},t.prototype.xu=function(){return this.Fu(this.Pu)},t.prototype.Ou=function(t){var e=!1;return this.Pu.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.ku=function(t){this.Mu(t,"pending")},t.prototype.$u=function(t,e,n){this.Mu(t,e,n),this.Lu(t)},t.prototype.Bu=function(t){var e="not-current";if(this.Ou(t)){var n=this.storage.getItem(Co(this.persistenceKey,t));if(n){var r=Mo.du(t,n);r&&(e=r.state)}}return this.qu.Eu(t),this.Du(),e},t.prototype.Uu=function(t){this.qu.Tu(t),this.Du()},t.prototype.Ku=function(t){return this.qu.activeTargetIds.has(t)},t.prototype.Qu=function(t){this.removeItem(Co(this.persistenceKey,t))},t.prototype.Wu=function(t,e,n){this.ju(t,e,n)},t.prototype.Gu=function(t,e,n){var r=this;e.forEach((function(t){r.Lu(t)})),this.currentUser=t,n.forEach((function(t){r.ku(t)}))},t.prototype.zu=function(t){this.Hu(t)},t.prototype.ga=function(){this.br&&(this.window.removeEventListener("storage",this.Au),this.removeItem(this.yu),this.br=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return l("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){l("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){l("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Ru=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(l("SharedClientState","EVENT",r.key,r.newValue),r.key===this.yu)return void p("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.fn.Cs((function(){return Object(e.b)(n,void 0,void 0,(function(){var t,n,i,o,u,s;return Object(e.d)(this,(function(e){if(this.br){if(null!==r.key)if(this.pu.test(r.key)){if(null==r.newValue)return t=this.Yu(r.key),[2,this.Ju(t,null)];if(n=this.Xu(r.key,r.newValue))return[2,this.Ju(n.clientId,n)]}else if(this.bu.test(r.key)){if(null!==r.newValue&&(i=this.Zu(r.key,r.newValue)))return[2,this.th(i)]}else if(this.vu.test(r.key)){if(null!==r.newValue&&(o=this.eh(r.key,r.newValue)))return[2,this.nh(o)]}else if(r.key===this.Su){if(null!==r.newValue&&(u=this.Cu(r.newValue)))return[2,this.Nu(u)]}else r.key===this.Vu&&(s=function(t){var e=kr.ir;if(null!=t)try{var n=JSON.parse(t);m("number"==typeof n),e=n}catch(t){p("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(r.newValue))!==kr.ir&&this.tr(s)}else this.gu.push(r);return[2]}))}))}))}},Object.defineProperty(t.prototype,"qu",{get:function(){return this.Pu.get(this.Iu)},enumerable:!1,configurable:!0}),t.prototype.Du=function(){this.setItem(this.yu,this.qu.wu())},t.prototype.Mu=function(t,e,n){var r=new qo(this.currentUser,t,e,n),i=Uo(this.persistenceKey,this.currentUser,t);this.setItem(i,r.wu())},t.prototype.Lu=function(t){var e=Uo(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Hu=function(t){var e={clientId:this.Iu,onlineState:t};this.storage.setItem(this.Su,JSON.stringify(e))},t.prototype.ju=function(t,e,n){var r=Co(this.persistenceKey,t),i=new Mo(t,e,n);this.setItem(r,i.wu())},t.prototype.Yu=function(t){var e=this.pu.exec(t);return e?e[1]:null},t.prototype.Xu=function(t,e){var n=this.Yu(t);return Fo.du(n,e)},t.prototype.Zu=function(t,e){var n=this.bu.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return qo.du(new mr(i),r,e)},t.prototype.eh=function(t,e){var n=this.vu.exec(t),r=Number(n[1]);return Mo.du(r,e)},t.prototype.Cu=function(t){return Bo.du(t)},t.prototype.th=function(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.mu.sh(t.batchId,t.state,t.error)]:(l("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.nh=function(t){return this.mu.ih(t.targetId,t.state,t.error)},t.prototype.Ju=function(t,e){var n=this,r=e?this.Pu.ot(t,e):this.Pu.remove(t),i=this.Fu(this.Pu),o=this.Fu(r),u=[],s=[];return o.forEach((function(t){i.has(t)||u.push(t)})),i.forEach((function(t){o.has(t)||s.push(t)})),this.mu.rh(u,s).then((function(){n.Pu=r}))},t.prototype.Nu=function(t){this.Pu.get(t.clientId)&&this.Cc(t.onlineState)},t.prototype.Fu=function(t){var e=yt();return t.forEach((function(t,n){e=e.kt(n.activeTargetIds)})),e},t}(),Ko=function(){function t(){this.oh=new zo,this.ah={},this.Cc=null,this.tr=null}return t.prototype.ku=function(t){},t.prototype.$u=function(t,e,n){},t.prototype.Bu=function(t){return this.oh.Eu(t),this.ah[t]||"not-current"},t.prototype.Wu=function(t,e,n){this.ah[t]=e},t.prototype.Uu=function(t){this.oh.Tu(t)},t.prototype.Ku=function(t){return this.oh.activeTargetIds.has(t)},t.prototype.Qu=function(t){delete this.ah[t]},t.prototype.xu=function(){return this.oh.activeTargetIds},t.prototype.Ou=function(t){return this.oh.activeTargetIds.has(t)},t.prototype.start=function(){return this.oh=new zo,Promise.resolve()},t.prototype.Gu=function(t,e,n){},t.prototype.zu=function(t){},t.prototype.ga=function(){},t.prototype.sr=function(t){},t}(),Wo=function(t){this.key=t},Qo=function(t){this.key=t},Ho=function(){function t(t,e){this.query=t,this.uh=e,this.hh=null,this.te=!1,this.lh=dt(),this.Qt=dt(),this._h=jn(t),this.fh=new mt(this._h)}return Object.defineProperty(t.prototype,"dh",{get:function(){return this.uh},enumerable:!1,configurable:!0}),t.prototype.wh=function(t,e){var n=this,r=e?e.Eh:new gt,i=e?e.fh:this.fh,o=e?e.Qt:this.Qt,u=i,s=!1,a=vn(this.query)&&i.size===this.query.limit?i.last():null,c=yn(this.query)&&i.size===this.query.limit?i.first():null;if(t.ht((function(t,e){var h=i.get(t),f=e instanceof cn?e:null;f&&(f=Dn(n.query,f)?f:null);var l=!!h&&n.Qt.has(h.key),p=!!f&&(f.Je||n.Qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Th(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n._h(f,a)>0||c&&n._h(f,c)<0)&&(s=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(s=!0)),d&&(f?(u=u.add(f),o=p?o.add(t):o.delete(t)):(u=u.delete(t),o=o.delete(t)))})),vn(this.query)||yn(this.query))for(;u.size>this.query.limit;){var h=vn(this.query)?u.last():u.first();u=u.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fh:u,Eh:r,Ih:s,Qt:o}},t.prototype.Th=function(t,e){return t.Je&&e.hasCommittedMutations&&!e.Je},t.prototype.Di=function(t,e,n){var r=this,i=this.fh;this.fh=t.fh,this.Qt=t.Qt;var o=t.Eh.Ut();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return y()}};return n(t)-n(e)}(t.type,e.type)||r._h(t.doc,e.doc)})),this.mh(n);var u=e?this.Ah():[],s=0===this.lh.size&&this.te?1:0,a=s!==this.hh;return this.hh=s,0!==o.length||a?{snapshot:new bt(this.query,t.fh,i,o,t.Qt,0===s,a,!1),Rh:u}:{Rh:u}},t.prototype.Ks=function(t){return this.te&&"Offline"===t?(this.te=!1,this.Di({fh:this.fh,Eh:new gt,Qt:this.Qt,Ih:!1},!1)):{Rh:[]}},t.prototype.Ph=function(t){return!this.uh.has(t)&&!!this.fh.has(t)&&!this.fh.get(t).Je},t.prototype.mh=function(t){var e=this;t&&(t.ee.forEach((function(t){return e.uh=e.uh.add(t)})),t.ne.forEach((function(t){})),t.se.forEach((function(t){return e.uh=e.uh.delete(t)})),this.te=t.te)},t.prototype.Ah=function(){var t=this;if(!this.te)return[];var e=this.lh;this.lh=dt(),this.fh.forEach((function(e){t.Ph(e.key)&&(t.lh=t.lh.add(e.key))}));var n=[];return e.forEach((function(e){t.lh.has(e)||n.push(new Qo(e))})),this.lh.forEach((function(t){e.has(t)||n.push(new Wo(t))})),n},t.prototype.gh=function(t){this.uh=t.za,this.lh=dt();var e=this.wh(t.documents);return this.Di(e,!0)},t.prototype.yh=function(){return bt.Gt(this.query,this.fh,this.Qt,0===this.hh)},t}(),Yo=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Jo=function(t){this.key=t,this.Vh=!1},Xo=function(){function t(t,e,n,r,i,o){this.Bc=t,this.ph=e,this.bh=n,this.Sh=r,this.currentUser=i,this.Dh=o,this.Ch={},this.Nh=new L((function(t){return Nn(t)}),Tn),this.xh=new Map,this.Fh=[],this.Oh=new nt(F.D),this.kh=new Map,this.Mh=new Lo,this.$h={},this.Lh=new Map,this.Bh=ki.Vo(),this.onlineState="Unknown",this.qh=void 0}return Object.defineProperty(t.prototype,"Uh",{get:function(){return!0===this.qh},enumerable:!1,configurable:!0}),t}();function Zo(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=Nu(t),(u=r.Nh.get(n))?(i=u.targetId,r.Sh.Bu(i),o=u.view.yh(),[3,4]):[3,1];case 1:return[4,Yi(r.Bc,In(n))];case 2:return s=e.sent(),a=r.Sh.Bu(s.targetId),i=s.targetId,[4,$o(r,n,i,"current"===a)];case 3:o=e.sent(),r.Uh&&ho(r.ph,s),e.label=4;case 4:return[2,o]}}))}))}function $o(t,n,r,i){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s,a,c,h;return Object(e.d)(this,(function(f){switch(f.label){case 0:return t.Kh=function(n,r,i){return function(t,n,r,i){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(o=n.view.wh(r)).Ih?[4,Xi(t.Bc,n.query,!1).then((function(t){var e=t.documents;return n.view.wh(e,o)}))]:[3,2];case 1:o=e.sent(),e.label=2;case 2:return u=i&&i.zt.get(n.targetId),s=n.view.Di(o,t.Uh,u),[2,(lu(t,n.targetId,s.Rh),s.snapshot)]}}))}))}(t,n,r,i)},[4,Xi(t.Bc,n,!0)];case 1:return o=f.sent(),u=new Ho(n,o.za),s=u.wh(o.documents),a=It.Zt(r,i&&"Offline"!==t.onlineState),c=u.Di(s,t.Uh,a),lu(t,r,c.Rh),h=new Yo(n,r,u),[2,(t.Nh.set(n,h),t.xh.has(r)?t.xh.get(r).push(n):t.xh.set(r,[n]),c.snapshot)]}}))}))}function tu(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=g(t),i=r.Nh.get(n),(o=r.xh.get(i.targetId)).length>1?[2,(r.xh.set(i.targetId,o.filter((function(t){return!Tn(t,n)}))),void r.Nh.delete(n))]:r.Uh?(r.Sh.Uu(i.targetId),r.Sh.Ou(i.targetId)?[3,2]:[4,Ji(r.Bc,i.targetId,!1).then((function(){r.Sh.Qu(i.targetId),fo(r.ph,i.targetId),hu(r,i.targetId)})).catch(eo)]):[3,3];case 1:e.sent(),e.label=2;case 2:return[3,5];case 3:return hu(r,i.targetId),[4,Ji(r.Bc,i.targetId,!0)];case 4:e.sent(),e.label=5;case 5:return[2]}}))}))}function eu(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:i=Au(t),e.label=1;case 1:return e.trys.push([1,5,,6]),[4,function(t,e){var n,r=g(t),i=V.now(),o=e.reduce((function(t,e){return t.add(e.key)}),dt());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Ka.qi(t,o).next((function(o){n=o;for(var u=[],s=0,a=e;s<a.length;s++){var c=a[s],h=Qe(c,n.get(c.key));null!=h&&u.push(new Xe(c.key,h,sn(h.proto.mapValue),Be.exists(!0)))}return r.Oi.Wr(t,i,u,e)}))})).then((function(t){var e=t.Ii(n);return{batchId:t.batchId,Ri:e}}))}(i.Bc,n)];case 2:return o=e.sent(),i.Sh.ku(o.batchId),function(t,e,n){var r=t.$h[t.currentUser.ti()];r||(r=new nt(I)),r=r.ot(e,n),t.$h[t.currentUser.ti()]=r}(i,o.batchId,r),[4,vu(i,o.Ri)];case 3:return e.sent(),[4,_o(i.ph)];case 4:return e.sent(),[3,6];case 5:return u=e.sent(),s=ar(u,"Failed to persist write"),r.reject(s),[3,6];case 6:return[2]}}))}))}function nu(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=g(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Qi(r.Bc,n)];case 2:return i=e.sent(),n.zt.forEach((function(t,e){var n=r.kh.get(e);n&&(m(t.ee.size+t.ne.size+t.se.size<=1),t.ee.size>0?n.Vh=!0:t.ne.size>0?m(n.Vh):t.se.size>0&&(m(n.Vh),n.Vh=!1))})),[4,vu(r,i,n)];case 3:return e.sent(),[3,6];case 4:return[4,eo(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}}))}))}function ru(t,e,n){var r=g(t);if(r.Uh&&0===n||!r.Uh&&1===n){var i=[];r.Nh.forEach((function(t,n){var r=n.view.Ks(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=g(t);n.onlineState=e;var r=!1;n.Bs.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Ks(e)&&(r=!0)})),r&&vr(n)}(r.bh,e),i.length&&r.Ch.Tc(i),r.onlineState=e,r.Uh&&r.Sh.zu(e)}}function iu(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u,s,a,c;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(i=g(t)).Sh.Wu(n,"rejected",r),o=i.kh.get(n),(u=o&&o.key)?(s=(s=new nt(F.D)).ot(u,new hn(u,R.min())),a=dt().add(u),c=new wt(R.min(),new Map,new ot(I),s,a),[4,nu(i,c)]):[3,2];case 1:return e.sent(),i.Oh=i.Oh.remove(u),i.kh.delete(n),du(i),[3,4];case 2:return[4,Ji(i.Bc,n,!1).then((function(){return hu(i,n,r)})).catch(eo)];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))}function ou(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=g(t),i=n.batch.batchId,e.label=1;case 1:return e.trys.push([1,4,,6]),[4,Ki(r.Bc,n)];case 2:return o=e.sent(),cu(r,i,null),au(r,i),r.Sh.$u(i,"acknowledged"),[4,vu(r,o)];case 3:return e.sent(),[3,6];case 4:return[4,eo(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}}))}))}function uu(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:i=g(t),e.label=1;case 1:return e.trys.push([1,4,,6]),[4,function(t,e){var n=g(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Oi.Gr(t,e).next((function(e){return m(null!==e),r=e.keys(),n.Oi.Zr(t,e)})).next((function(){return n.Oi.io(t)})).next((function(){return n.Ka.qi(t,r)}))}))}(i.Bc,n)];case 2:return o=e.sent(),cu(i,n,r),au(i,n),i.Sh.$u(n,"rejected",r),[4,vu(i,o)];case 3:return e.sent(),[3,6];case 4:return[4,eo(e.sent())];case 5:return e.sent(),[3,6];case 6:return[2]}}))}))}function su(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:mo((r=g(t)).ph)||l("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(t){var e=g(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Oi.Yr(t)}))}(r.Bc)];case 2:return-1===(i=e.sent())?[2,void n.resolve()]:((o=r.Lh.get(i)||[]).push(n),r.Lh.set(i,o),[3,4]);case 3:return u=e.sent(),s=ar(u,"Initialization of waitForPendingWrites() operation failed"),n.reject(s),[3,4];case 4:return[2]}}))}))}function au(t,e){(t.Lh.get(e)||[]).forEach((function(t){t.resolve()})),t.Lh.delete(e)}function cu(t,e,n){var r=g(t),i=r.$h[r.currentUser.ti()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.$h[r.currentUser.ti()]=i}}function hu(t,e,n){void 0===n&&(n=null),t.Sh.Uu(e);for(var r=0,i=t.xh.get(e);r<i.length;r++){var o=i[r];t.Nh.delete(o),n&&t.Ch.Qh(o,n)}t.xh.delete(e),t.Uh&&t.Mh.hu(e).forEach((function(e){t.Mh.ro(e)||fu(t,e)}))}function fu(t,e){var n=t.Oh.get(e);null!==n&&(fo(t.ph,n),t.Oh=t.Oh.remove(e),t.kh.delete(n),du(t))}function lu(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Wo?(t.Mh.qo(o.key,e),pu(t,o)):o instanceof Qo?(l("SyncEngine","Document no longer in limbo: "+o.key),t.Mh.Ko(o.key,e),t.Mh.ro(o.key)||fu(t,o.key)):y()}}function pu(t,e){var n=e.key;t.Oh.get(n)||(l("SyncEngine","New document in limbo: "+n),t.Fh.push(n),du(t))}function du(t){for(;t.Fh.length>0&&t.Oh.size<t.Dh;){var e=t.Fh.shift(),n=t.Bh.next();t.kh.set(n,new Jo(e)),t.Oh=t.Oh.ot(e,n),ho(t.ph,new Z(In(dn(e.path)),n,2,kr.ir))}}function vu(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u,s;return Object(e.d)(this,(function(a){switch(a.label){case 0:return i=g(t),o=[],u=[],s=[],i.Nh.P()?[3,3]:(i.Nh.forEach((function(t,e){s.push(i.Kh(e,n,r).then((function(t){if(t){i.Uh&&i.Sh.Wu(e.targetId,t.fromCache?"not-current":"current"),o.push(t);var n=jr.Zi(e.targetId,t);u.push(n)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),i.Ch.Tc(o),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c,h,f;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=g(t),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Hn.forEach(n,(function(e){return Hn.forEach(e.Ji,(function(n){return r.persistence.qr.qo(t,e.targetId,n)})).next((function(){return Hn.forEach(e.Xi,(function(n){return r.persistence.qr.Ko(t,e.targetId,n)}))}))}))}))];case 2:return e.sent(),[3,4];case 3:if(!Zn(i=e.sent()))throw i;return l("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0,u=n;o<u.length;o++)s=u[o],a=s.targetId,s.fromCache||(c=r.La.get(a),h=c.nt,f=c.rt(h),r.La=r.La.ot(a,f));return[2]}}))}))}(i.Bc,u)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function yu(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(r=g(t)).currentUser.isEqual(n)?[3,3]:(l("SyncEngine","User change. New user:",n.ti()),[4,Gi(r.Bc,n)]);case 1:return i=e.sent(),r.currentUser=n,function(t,e){t.Lh.forEach((function(t){t.forEach((function(t){t.reject(new c(a.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Lh.clear()}(r),r.Sh.Gu(n,i.ja,i.Ga),[4,vu(r,i.Wa)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}function mu(t,e){var n=g(t),r=n.kh.get(e);if(r&&r.Vh)return dt().add(r.key);var i=dt(),o=n.xh.get(e);if(!o)return i;for(var u=0,s=o;u<s.length;u++){var a=s[u],c=n.Nh.get(a);i=i.kt(c.view.dh)}return i}function gu(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,Xi((r=g(t)).Bc,n.query,!0)];case 1:return i=e.sent(),o=n.view.gh(i),[2,(r.Uh&&lu(r,n.targetId,o.Rh),o)]}}))}))}function bu(t,n,r,i){return Object(e.b)(this,void 0,void 0,(function(){var o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,function(t,e){var n=g(t),r=g(n.Oi);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.zr(t,e).next((function(e){return e?n.Ka.qi(t,e):Hn.resolve(null)}))}))}((o=g(t)).Bc,n)];case 1:return null===(u=e.sent())?[3,6]:"pending"!==r?[3,3]:[4,_o(o.ph)];case 2:return e.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(cu(o,n,i||null),au(o,n),function(t,e){g(g(t).Oi).no(e)}(o.Bc,n)):y(),e.label=4;case 4:return[4,vu(o,u)];case 5:return e.sent(),[3,7];case 6:l("SyncEngine","Cannot apply mutation batch with id: "+n),e.label=7;case 7:return[2]}}))}))}function wu(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c,h;return Object(e.d)(this,(function(e){switch(e.label){case 0:return Nu(r=g(t)),Au(r),!0!==n||!0===r.qh?[3,3]:(i=r.Sh.xu(),[4,Iu(r,i.L())]);case 1:return o=e.sent(),r.qh=!0,[4,xo(r.ph,!0)];case 2:for(e.sent(),u=0,s=o;u<s.length;u++)a=s[u],ho(r.ph,a);return[3,7];case 3:return!1!==n||!1===r.qh?[3,7]:(c=[],h=Promise.resolve(),r.xh.forEach((function(t,e){r.Sh.Ku(e)?c.push(e):h=h.then((function(){return hu(r,e),Ji(r.Bc,e,!0)})),fo(r.ph,e)})),[4,h]);case 4:return e.sent(),[4,Iu(r,c)];case 5:return e.sent(),function(t){var e=g(t);e.kh.forEach((function(t,n){fo(e.ph,n)})),e.Mh.lu(),e.kh=new Map,e.Oh=new nt(F.D)}(r),r.qh=!1,[4,xo(r.ph,!1)];case 6:e.sent(),e.label=7;case 7:return[2]}}))}))}function Iu(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a,c,h,f,l,p,d,v,y;return Object(e.d)(this,(function(e){switch(e.label){case 0:r=g(t),i=[],o=[],u=0,s=n,e.label=1;case 1:return u<s.length?(a=s[u],c=void 0,(h=r.xh.get(a))&&0!==h.length?[4,Yi(r.Bc,In(h[0]))]:[3,7]):[3,13];case 2:c=e.sent(),f=0,l=h,e.label=3;case 3:return f<l.length?(p=l[f],d=r.Nh.get(p),[4,gu(r,d)]):[3,6];case 4:(v=e.sent()).snapshot&&o.push(v.snapshot),e.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Zi(r.Bc,a)];case 8:return y=e.sent(),[4,Yi(r.Bc,y)];case 9:return c=e.sent(),[4,$o(r,Eu(y),a,!1)];case 10:e.sent(),e.label=11;case 11:i.push(c),e.label=12;case 12:return u++,[3,1];case 13:return[2,(r.Ch.Tc(o),i)]}}))}))}function Eu(t){return pn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ou(t){var e=g(t);return g(g(e.Bc).persistence).va()}function _u(t,n,r,i){return Object(e.b)(this,void 0,void 0,(function(){var o,u,s;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(o=g(t)).qh?(l("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.xh.has(n))return[3,8];switch(r){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,$i(o.Bc)];case 3:return u=e.sent(),s=wt.Xt(n,"current"===r),[4,vu(o,u,s)];case 4:return e.sent(),[3,8];case 5:return[4,Ji(o.Bc,n,!0)];case 6:return e.sent(),hu(o,n,i),[3,8];case 7:y(),e.label=8;case 8:return[2]}}))}))}function Tu(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u,s,a,c,h,f,p,d;return Object(e.d)(this,(function(v){switch(v.label){case 0:if(!(i=Nu(t)).qh)return[3,10];o=0,u=n,v.label=1;case 1:return o<u.length?(s=u[o],i.xh.has(s)?(l("SyncEngine","Adding an already active target "+s),[3,5]):[4,Zi(i.Bc,s)]):[3,6];case 2:return a=v.sent(),[4,Yi(i.Bc,a)];case 3:return c=v.sent(),[4,$o(i,Eu(a),c.targetId,!1)];case 4:v.sent(),ho(i.ph,c),v.label=5;case 5:return o++,[3,1];case 6:h=function(t){return Object(e.d)(this,(function(e){switch(e.label){case 0:return i.xh.has(t)?[4,Ji(i.Bc,t,!1).then((function(){fo(i.ph,t),hu(i,t)})).catch(eo)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,p=r,v.label=7;case 7:return f<p.length?(d=p[f],[5,h(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function Nu(t){var e=g(t);return e.ph.Uc.Xc=nu.bind(null,e),e.ph.Uc.qe=mu.bind(null,e),e.ph.Uc.Jc=iu.bind(null,e),e.Ch.Tc=pr.bind(null,e.bh),e.Ch.Qh=dr.bind(null,e.bh),e}function Au(t){var e=g(t);return e.ph.Uc.Zc=ou.bind(null,e),e.ph.Uc.tu=uu.bind(null,e),e}var Du=function(){function t(){}return t.prototype.Qa=function(t){this.Wh=t},t.prototype.Qi=function(t,e,n,r){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.on.length||1===t.on.length&&t.on[0].field.W())}(e)||n.isEqual(R.min())?this.jh(t,e):this.Wh.qi(t,r).next((function(u){var s=o.Gh(e,u);return(vn(e)||yn(e))&&o.Ih(e.an,s,r,n)?o.jh(t,e):(f()<=i.a.DEBUG&&l("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),An(e)),o.Wh.Qi(t,e,n).next((function(t){return s.forEach((function(e){t=t.ot(e.key,e)})),t})))}))},t.prototype.Gh=function(t,e){var n=new ot(jn(t));return e.forEach((function(e,r){r instanceof cn&&Dn(t,r)&&(n=n.add(r))})),n},t.prototype.Ih=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.u(r)>0)},t.prototype.jh=function(t,e){return f()<=i.a.DEBUG&&l("IndexFreeQueryEngine","Using full collection scan to execute query:",An(e)),this.Wh.Qi(t,e,R.min())},t}(),ju=function(){function t(t,e){this.ki=t,this.qr=e,this.Oi=[],this.zh=1,this.Hh=new ot(Vo.iu)}return t.prototype.Qr=function(t){return Hn.resolve(0===this.Oi.length)},t.prototype.Wr=function(t,e,n,r){var i=this.zh;this.zh++,this.Oi.length>0&&this.Oi[this.Oi.length-1];var o=new Or(i,e,n,r);this.Oi.push(o);for(var u=0,s=r;u<s.length;u++){var a=s[u];this.Hh=this.Hh.add(new Vo(a.key,i)),this.ki.jr(t,a.key.path.F())}return Hn.resolve(o)},t.prototype.Gr=function(t,e){return Hn.resolve(this.Yh(e))},t.prototype.Hr=function(t,e){var n=e+1,r=this.Jh(n),i=r<0?0:r;return Hn.resolve(this.Oi.length>i?this.Oi[i]:null)},t.prototype.Yr=function(){return Hn.resolve(0===this.Oi.length?-1:this.zh-1)},t.prototype.Jr=function(t){return Hn.resolve(this.Oi.slice())},t.prototype.$i=function(t,e){var n=this,r=new Vo(e,0),i=new Vo(e,Number.POSITIVE_INFINITY),o=[];return this.Hh.xt([r,i],(function(t){var e=n.Yh(t.fu);o.push(e)})),Hn.resolve(o)},t.prototype.Ki=function(t,e){var n=this,r=new ot(I);return e.forEach((function(t){var e=new Vo(t,0),i=new Vo(t,Number.POSITIVE_INFINITY);n.Hh.xt([e,i],(function(t){r=r.add(t.fu)}))})),Hn.resolve(this.Xh(r))},t.prototype.Hi=function(t,e){var n=e.path,r=n.length+1,i=n;F.X(i)||(i=i.child(""));var o=new Vo(new F(i),0),u=new ot(I);return this.Hh.Ft((function(t){var e=t.key.path;return!!n.M(e)&&(e.length===r&&(u=u.add(t.fu)),!0)}),o),Hn.resolve(this.Xh(u))},t.prototype.Xh=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Yh(t);null!==r&&n.push(r)})),n},t.prototype.Zr=function(t,e){var n=this;m(0===this.Zh(e.batchId,"removed")),this.Oi.shift();var r=this.Hh;return Hn.forEach(e.mutations,(function(i){var o=new Vo(i.key,e.batchId);return r=r.delete(o),n.qr.so(t,i.key)})).next((function(){n.Hh=r}))},t.prototype.no=function(t){},t.prototype.ro=function(t,e){var n=new Vo(e,0),r=this.Hh.Ot(n);return Hn.resolve(e.isEqual(r&&r.key))},t.prototype.io=function(t){return this.Oi.length,Hn.resolve()},t.prototype.Zh=function(t,e){return this.Jh(t)},t.prototype.Jh=function(t){return 0===this.Oi.length?0:t-this.Oi[0].batchId},t.prototype.Yh=function(t){var e=this.Jh(t);return e<0||e>=this.Oi.length?null:this.Oi[e]},t}(),ku=function(){function t(t,e){this.ki=t,this.tl=e,this.docs=new nt(F.D),this.size=0}return t.prototype.yi=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,u=this.tl(e);return this.docs=this.docs.ot(r,{ho:e,size:u,readTime:n}),this.size+=u-o,this.ki.jr(t,r.path.F())},t.prototype.pi=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.bi=function(t,e){var n=this.docs.get(e);return Hn.resolve(n?n.ho:null)},t.prototype.getEntries=function(t,e){var n=this,r=ct();return e.forEach((function(t){var e=n.docs.get(t);r=r.ot(t,e?e.ho:null)})),Hn.resolve(r)},t.prototype.Qi=function(t,e,n){for(var r=ft(),i=new F(e.path.child("")),o=this.docs.ft(i);o.At();){var u=o.It(),s=u.key,a=u.value,c=a.ho,h=a.readTime;if(!e.path.M(s.path))break;h.u(n)<=0||c instanceof cn&&Dn(e,c)&&(r=r.ot(c.key,c))}return Hn.resolve(r)},t.prototype.el=function(t,e){return Hn.forEach(this.docs,(function(t){return e(t)}))},t.prototype.wo=function(t){return new xu(this)},t.prototype.To=function(t){return Hn.resolve(this.size)},t}(),xu=function(t){function n(e){var n=this;return(n=t.call(this)||this).Io=e,n}return Object(e.c)(n,t),n.prototype.Di=function(t){var e=this,n=[];return this.Ri.forEach((function(r,i){i?n.push(e.Io.yi(t,i,e.readTime)):e.Io.pi(r)})),Hn.On(n)},n.prototype.vi=function(t,e){return this.Io.bi(t,e)},n.prototype.Si=function(t,e){return this.Io.getEntries(t,e)},n}(Tr),Su=function(){function t(t){this.persistence=t,this.nl=new L((function(t){return Q(t)}),H),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.sl=0,this.il=new Lo,this.targetCount=0,this.rl=ki.yo()}return t.prototype.Ce=function(t,e){return this.nl.forEach((function(t,n){return e(n)})),Hn.resolve()},t.prototype.So=function(t){return Hn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Do=function(t){return Hn.resolve(this.sl)},t.prototype.po=function(t){return this.highestTargetId=this.rl.next(),Hn.resolve(this.highestTargetId)},t.prototype.Co=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.sl&&(this.sl=e),Hn.resolve()},t.prototype.xo=function(t){this.nl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.rl=new ki(e),this.highestTargetId=e),t.sequenceNumber>this.sl&&(this.sl=t.sequenceNumber)},t.prototype.No=function(t,e){return this.xo(e),this.targetCount+=1,Hn.resolve()},t.prototype.Oo=function(t,e){return this.xo(e),Hn.resolve()},t.prototype.ko=function(t,e){return this.nl.delete(e.target),this.il.hu(e.targetId),this.targetCount-=1,Hn.resolve()},t.prototype.Or=function(t,e,n){var r=this,i=0,o=[];return this.nl.forEach((function(u,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.nl.delete(u),o.push(r.Mo(t,s.targetId)),i++)})),Hn.On(o).next((function(){return i}))},t.prototype.$o=function(t){return Hn.resolve(this.targetCount)},t.prototype.Lo=function(t,e){var n=this.nl.get(e)||null;return Hn.resolve(n)},t.prototype.Bo=function(t,e,n){return this.il.au(e,n),Hn.resolve()},t.prototype.Uo=function(t,e,n){this.il.uu(e,n);var r=this.persistence.qr,i=[];return r&&e.forEach((function(e){i.push(r.so(t,e))})),Hn.On(i)},t.prototype.Mo=function(t,e){return this.il.hu(e),Hn.resolve()},t.prototype.Qo=function(t,e){var n=this.il._u(e);return Hn.resolve(n)},t.prototype.ro=function(t,e){return Hn.resolve(this.il.ro(e))},t}(),Pu=function(){function t(t){var e=this;this.ol={},this.zo=new kr(0),this.Ho=!1,this.Ho=!0,this.qr=t(this),this.sa=new Su(this),this.ki=new ci,this.Fi=function(t,n){return new ku(t,(function(t){return e.qr.al(t)}))}(this.ki)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.ga=function(){return this.Ho=!1,Promise.resolve()},Object.defineProperty(t.prototype,"br",{get:function(){return this.Ho},enumerable:!1,configurable:!0}),t.prototype.ha=function(){},t.prototype.la=function(){},t.prototype.Na=function(){return this.ki},t.prototype.Sa=function(t){var e=this.ol[t.ti()];return e||(e=new ju(this.ki,this.qr),this.ol[t.ti()]=e),e},t.prototype.Da=function(){return this.sa},t.prototype.Ca=function(){return this.Fi},t.prototype.runTransaction=function(t,e,n){var r=this;l("MemoryPersistence","Starting transaction:",t);var i=new Lu(this.zo.next());return this.qr.cl(),n(i).next((function(t){return r.qr.ul(i).next((function(){return t}))})).xn().then((function(t){return i.xi(),t}))},t.prototype.hl=function(t,e){return Hn.kn(Object.values(this.ol).map((function(n){return function(){return n.ro(t,e)}})))},t}(),Lu=function(t){function n(e){var n=this;return(n=t.call(this)||this).Wo=e,n}return Object(e.c)(n,t),n}(Ar),Vu=function(){function t(t){this.persistence=t,this.ll=new Lo,this._l=null}return t.fl=function(e){return new t(e)},Object.defineProperty(t.prototype,"dl",{get:function(){if(this._l)return this._l;throw y()},enumerable:!1,configurable:!0}),t.prototype.qo=function(t,e,n){return this.ll.qo(n,e),this.dl.delete(n.toString()),Hn.resolve()},t.prototype.Ko=function(t,e,n){return this.ll.Ko(n,e),this.dl.add(n.toString()),Hn.resolve()},t.prototype.so=function(t,e){return this.dl.add(e.toString()),Hn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.ll.hu(e.targetId).forEach((function(t){return n.dl.add(t.toString())}));var r=this.persistence.Da();return r.Qo(t,e.targetId).next((function(t){t.forEach((function(t){return n.dl.add(t.toString())}))})).next((function(){return r.ko(t,e)}))},t.prototype.cl=function(){this._l=new Set},t.prototype.ul=function(t){var e=this,n=this.persistence.Ca().wo();return Hn.forEach(this.dl,(function(r){var i=F.H(r);return e.wl(t,i).next((function(t){t||n.pi(i)}))})).next((function(){return e._l=null,n.apply(t)}))},t.prototype.Ma=function(t,e){var n=this;return this.wl(t,e).next((function(t){t?n.dl.delete(e.toString()):n.dl.add(e.toString())}))},t.prototype.al=function(t){return 0},t.prototype.wl=function(t,e){var n=this;return Hn.kn([function(){return Hn.resolve(n.ll.ro(e))},function(){return n.persistence.Da().ro(t,e)},function(){return n.persistence.hl(t,e)}])},t}(),Ru=function(){function t(t){this.El=t.El,this.Tl=t.Tl}return t.prototype.wc=function(t){this.Il=t},t.prototype.hc=function(t){this.ml=t},t.prototype.onMessage=function(t){this.Al=t},t.prototype.close=function(){this.Tl()},t.prototype.send=function(t){this.El(t)},t.prototype.Rl=function(){this.Il()},t.prototype.Pl=function(t){this.ml(t)},t.prototype.gl=function(t){this.Al(t)},t}(),Uu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Cu=function(t){function n(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.T=e.T,n}return Object(e.c)(n,t),n.prototype.Sl=function(t,e,n,r){return new Promise((function(i,o){var s=new u.d;s.listenOnce(u.b.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case u.a.NO_ERROR:var e=s.getResponseJson();l("Connection","XHR received:",JSON.stringify(e)),i(e);break;case u.a.TIMEOUT:l("Connection",'RPC "'+t+'" timed out'),o(new c(a.DEADLINE_EXCEEDED,"Request time out"));break;case u.a.HTTP_ERROR:var n=s.getStatus();if(l("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var h=function(t){var e=t.toLowerCase().replace("_","-");return Object.values(a).indexOf(e)>=0?e:a.UNKNOWN}(r.status);o(new c(h,r.message))}else o(new c(a.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new c(a.UNAVAILABLE,"Connection failed."));break;default:y()}}finally{l("Connection",'RPC "'+t+'" completed.')}}));var h=JSON.stringify(r);s.send(e,"POST",h,n,15)}))},n.prototype.Ec=function(t,e){var n=[this.Vl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(u.e)(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this._.projectId+"/databases/"+this._.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.T};this.vl(i.initMessageHeaders,e),Object(o.m)()||Object(o.o)()||Object(o.k)()||Object(o.l)()||Object(o.p)()||Object(o.j)()||(i.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");l("Connection","Creating WebChannel: "+s,i);var h=r.createWebChannel(s,i),f=!1,p=!1,v=new Ru({El:function(t){p?l("Connection","Not sending because WebChannel is closed:",t):(f||(l("Connection","Opening WebChannel transport."),h.open(),f=!0),l("Connection","WebChannel sending:",t),h.send(t))},Tl:function(){return h.close()}}),y=function(t,e){h.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return y(u.c.EventType.OPEN,(function(){p||l("Connection","WebChannel transport opened.")})),y(u.c.EventType.CLOSE,(function(){p||(p=!0,l("Connection","WebChannel transport closed"),v.Pl())})),y(u.c.EventType.ERROR,(function(t){p||(p=!0,d("Connection","WebChannel transport errored:",t),v.Pl(new c(a.UNAVAILABLE,"The operation could not be completed")))})),y(u.c.EventType.MESSAGE,(function(t){var e;if(!p){var n=t.data[0];m(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){l("Connection","WebChannel received error:",i);var o=i.status,u=function(t){var e=J[t];if(void 0!==e)return et(e)}(o),s=i.message;void 0===u&&(u=a.INTERNAL,s="Unknown error status: "+o+" with message "+i.message),p=!0,v.Pl(new c(u,s)),h.close()}else l("Connection","WebChannel received:",n),v.gl(n)}})),setTimeout((function(){v.Rl()}),0),v},n}(function(){function t(t){this.yl=t,this._=t._;var e=t.ssl?"https":"http";this.Vl=e+"://"+t.host,this.pl="projects/"+this._.projectId+"/databases/"+this._.database+"/documents"}return t.prototype.Sc=function(t,e,n,r){var i=this.bl(t,e);l("RestConnection","Sending: ",i,n);var o={};return this.vl(o,r),this.Sl(t,i,o,n).then((function(t){return l("RestConnection","Received: ",t),t}),(function(e){throw d("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Dc=function(t,e,n,r){return this.Sc(t,e,n,r)},t.prototype.vl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.0.1",t["Content-Type"]="text/plain",e)for(var n in e.si)e.si.hasOwnProperty(n)&&(t[n]=e.si[n])},t.prototype.bl=function(t,e){var n=Uu[t];return this.Vl+"/v1/"+e+":"+n},t}()),qu=function(){function t(){var t=this;this.Dl=function(){return t.Cl()},this.Nl=function(){return t.xl()},this.Fl=[],this.Ol()}return t.prototype.zc=function(t){this.Fl.push(t)},t.prototype.ga=function(){window.removeEventListener("online",this.Dl),window.removeEventListener("offline",this.Nl)},t.prototype.Ol=function(){window.addEventListener("online",this.Dl),window.addEventListener("offline",this.Nl)},t.prototype.Cl=function(){l("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(0)},t.prototype.xl=function(){l("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Fl;t<e.length;t++)(0,e[t])(1)},t.Ln=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Mu=function(){function t(){}return t.prototype.zc=function(t){},t.prototype.ga=function(){},t}();function Fu(t){return new Yt(t,!0)}var Bu=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.Sh=this.kl(t),this.persistence=this.Ml(t),[4,this.persistence.start()];case 1:return e.sent(),this.$l=this.Ll(t),this.Bc=this.Bl(t),[2]}}))}))},t.prototype.Ll=function(t){return null},t.prototype.Bl=function(t){return e=this.persistence,n=new Du,r=t.ql,new zi(e,n,r);var e,n,r},t.prototype.Ml=function(t){return new Pu(Vu.fl)},t.prototype.kl=function(t){return new Ko},t.prototype.terminate=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.$l&&this.$l.stop(),[4,this.Sh.ga()];case 1:return t.sent(),[4,this.persistence.ga()];case 2:return t.sent(),[2]}}))}))},t}(),zu=function(t){function n(e,n,r){var i=this;return(i=t.call(this)||this).Ul=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(e.c)(n,t),n.prototype.initialize=function(n){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return e.sent(),[4,to(this.Bc)];case 2:return e.sent(),[4,this.Ul.initialize(this,n)];case 3:return e.sent(),[4,Au(this.Ul.mu)];case 4:return e.sent(),[4,_o(this.Ul.ph)];case 5:return e.sent(),[2]}}))}))},n.prototype.Ll=function(t){var e=this.persistence.qr.gr;return new Vr(e,t.cs)},n.prototype.Ml=function(t){var e=Bi(t.yl._,t.yl.persistenceKey),n=void 0!==this.cacheSizeBytes?Lr.Ir(this.cacheSizeBytes):Lr.Rr,r=Fu(t.yl._);return new Ui(this.synchronizeTabs,e,t.clientId,n,t.cs,ir(),or(),r,this.Sh,!!this.forceOwnership)},n.prototype.kl=function(t){return new Ko},n}(Bu),Gu=function(t){function n(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ul=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(e.c)(n,t),n.prototype.initialize=function(n){return Object(e.b)(this,void 0,void 0,(function(){var r,i=this;return Object(e.d)(this,(function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Ul.mu,this.Sh instanceof Go?(this.Sh.mu={sh:bu.bind(null,r),ih:_u.bind(null,r),rh:Tu.bind(null,r),va:Ou.bind(null,r)},[4,this.Sh.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.ua((function(t){return Object(e.b)(i,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,wu(this.Ul.mu,t)];case 1:return e.sent(),this.$l&&(t&&!this.$l.br?this.$l.start(this.Bc):t||this.$l.stop()),[2]}}))}))}))];case 4:return o.sent(),[2]}}))}))},n.prototype.kl=function(t){var e=ir();if(!Go.Ln(e))throw new c(a.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Bi(t.yl._,t.yl.persistenceKey);return new Go(e,t.cs,n,t.clientId,t.ql)},n}(zu),Ku=function(){function t(){}return t.prototype.initialize=function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r=this;return Object(e.d)(this,(function(e){switch(e.label){case 0:return this.Bc?[3,2]:(this.Bc=t.Bc,this.Sh=t.Sh,this.qc=this.Kl(n),this.ph=this.Ql(n),this.bh=this.Wl(n),this.mu=this.jl(n,!t.synchronizeTabs),this.Sh.Cc=function(t){return ru(r.mu,t,1)},this.ph.Uc.Gl=yu.bind(null,this.mu),[4,xo(this.ph,this.mu.Uh)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.Wl=function(t){return new hr},t.prototype.Kl=function(t){var e,n=Fu(t.yl._),r=(e=t.yl,new Cu(e));return function(t,e,n){return new oo(t,e,n)}(t.credentials,r,n)},t.prototype.Ql=function(t){var e,n,r,i,o,u=this;return e=this.Bc,n=this.qc,r=t.cs,i=function(t){return ru(u.mu,t,0)},o=qu.Ln()?new qu:new Mu,new so(e,n,r,i,o)},t.prototype.jl=function(t,e){return function(t,e,n,r,i,o,u){var s=new Xo(t,e,n,r,i,o);return u&&(s.qh=!0),s}(this.Bc,this.ph,this.bh,this.Sh,t.ql,t.Dh,e)},t.prototype.terminate=function(){return function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=g(t),l("RemoteStore","RemoteStore shutting down."),n.Wc.add(5),[4,co(n)];case 1:return e.sent(),n.Gc.ga(),n.Hc.set("Unknown"),[2]}}))}))}(this.ph)},t}(),Wu=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.zl(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.zl(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Hl=function(){this.muted=!0},t.prototype.zl=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();function Qu(t,e,n){if(!n)throw new c(a.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Hu(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new c(a.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Yu(t,e,n,r){if(!0===e&&!0===r)throw new c(a.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Ju(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":y()}function Xu(t,e){if(e<=0)throw new c(a.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Zu=function(t){for(var e=0;e<t.length;++e)if(0===t[e].length)throw new c(a.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Yl=new M(t)},$u=function(t){function n(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return Object(e.c)(n,t),n.documentId=function(){return new n(M.j().B())},n.prototype.isEqual=function(t){return t instanceof n&&this.Yl.isEqual(t.Yl)},n}(Zu),ts=new RegExp("[~\\*/\\[\\]]"),es=function(t){this.Jl=t},ns=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.Xl=function(t){if(2!==t.Zl)throw 1===t.Zl?t.t_(this.Jl+"() can only appear at the top level of your update data"):t.t_(this.Jl+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},n.prototype.isEqual=function(t){return t instanceof n},n}(es);function rs(t,e,n){return new vs({Zl:3,e_:e.settings.e_,methodName:t.Jl,n_:n},e._,e.serializer,e.ignoreUndefinedProperties)}var is=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.Xl=function(t){return new Me(t.path,new xe)},n.prototype.isEqual=function(t){return t instanceof n},n}(es),os=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).s_=n,r}return Object(e.c)(n,t),n.prototype.Xl=function(t){var e=rs(this,t,!0),n=this.s_.map((function(t){return Is(t,e)})),r=new Se(n);return new Me(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(es),us=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).s_=n,r}return Object(e.c)(n,t),n.prototype.Xl=function(t){var e=rs(this,t,!0),n=this.s_.map((function(t){return Is(t,e)})),r=new Le(n);return new Me(t.path,r)},n.prototype.isEqual=function(t){return this===t},n}(es),ss=function(t){function n(e,n){var r=this;return(r=t.call(this,e)||this).i_=n,r}return Object(e.c)(n,t),n.prototype.Xl=function(t){var e=new Re(t.serializer,Zt(t.serializer,this.i_));return new Me(t.path,e)},n.prototype.isEqual=function(t){return this===t},n}(es),as=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new c(a.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new c(a.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.r_=t,this.o_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.r_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.o_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.r_===t.r_&&this.o_===t.o_},t.prototype.toJSON=function(){return{latitude:this.r_,longitude:this.o_}},t.prototype.g=function(t){return I(this.r_,t.r_)||I(this.o_,t.o_)},t}(),cs=function(t){this.a_=t},hs=/^__.*__$/,fs=function(t,e,n){this.c_=t,this.u_=e,this.h_=n},ls=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.l_=function(t,e){var n=[];return null!==this.Qe?n.push(new Xe(t,this.data,this.Qe,e)):n.push(new Je(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new $e(t,this.fieldTransforms)),n},t}(),ps=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.l_=function(t,e){var n=[new Xe(t,this.data,this.Qe,e)];return this.fieldTransforms.length>0&&n.push(new $e(t,this.fieldTransforms)),n},t}();function ds(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw y()}}var vs=function(){function t(t,e,n,r,i,o){this.settings=t,this._=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.__(),this.fieldTransforms=i||[],this.Qe=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Zl",{get:function(){return this.settings.Zl},enumerable:!1,configurable:!0}),t.prototype.f_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this._,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},t.prototype.d_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.f_({path:n,n_:!1});return r.w_(t),r},t.prototype.E_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.f_({path:n,n_:!1});return r.__(),r},t.prototype.T_=function(t){return this.f_({path:void 0,n_:!0})},t.prototype.t_=function(t){return As(t,this.settings.methodName,this.settings.I_||!1,this.path,this.settings.e_)},t.prototype.contains=function(t){return void 0!==this.Qe.find((function(e){return t.M(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.M(e.field)}))},t.prototype.__=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.w_(this.path.get(t))},t.prototype.w_=function(t){if(0===t.length)throw this.t_("Document fields must not be empty");if(ds(this.Zl)&&hs.test(t))throw this.t_('Document fields cannot begin and end with "__"')},t}(),ys=function(){function t(t,e,n){this._=t,this.ignoreUndefinedProperties=e,this.serializer=n||Fu(t)}return t.prototype.m_=function(t,e,n,r){return void 0===r&&(r=!1),new vs({Zl:t,methodName:e,e_:n,path:M.U(),n_:!1,I_:r},this._,this.serializer,this.ignoreUndefinedProperties)},t}();function ms(t,e,n,r,i,o){void 0===o&&(o={});var u=t.m_(o.merge||o.mergeFields?2:0,e,n,i);_s("Data must be an object, but it was:",u,r);var s,h,f=Es(r,u);if(o.merge)s=new qe(u.Qe),h=u.fieldTransforms;else if(o.mergeFields){for(var l=[],p=0,d=o.mergeFields;p<d.length;p++){var v=d[p],m=void 0;if(v instanceof Zu)m=v.Yl;else{if("string"!=typeof v)throw y();m=Ns(e,v,n)}if(!u.contains(m))throw new c(a.INVALID_ARGUMENT,"Field '"+m+"' is specified in your field mask but missing from your input data.");Ds(l,m)||l.push(m)}s=new qe(l),h=u.fieldTransforms.filter((function(t){return s.Ye(t.field)}))}else s=null,h=u.fieldTransforms;return new ls(new on(f),s,h)}function gs(t,e,n,r){var i=t.m_(1,e,n);_s("Data must be an object, but it was:",i,r);var o=[],u=new un;S(r,(function(t,r){var s=Ns(e,t,n),a=i.E_(s);if(r instanceof ns||r instanceof cs&&r.a_ instanceof ns)o.push(s);else{var c=Is(r,a);null!=c&&(o.push(s),u.set(s,c))}}));var s=new qe(o);return new ps(u.Xe(),s,i.fieldTransforms)}function bs(t,e,n,r,i,o){var u=t.m_(1,e,n),s=[Ts(e,r,n)],h=[i];if(o.length%2!=0)throw new c(a.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var f=0;f<o.length;f+=2)s.push(Ts(e,o[f])),h.push(o[f+1]);for(var l=[],p=new un,d=s.length-1;d>=0;--d)if(!Ds(l,s[d])){var v=s[d],y=h[d],m=u.E_(v);if(y instanceof ns||y instanceof cs&&y.a_ instanceof ns)l.push(v);else{var g=Is(y,m);null!=g&&(l.push(v),p.set(v,g))}}var b=new qe(l);return new ps(p.Xe(),b,u.fieldTransforms)}function ws(t,e,n,r){return void 0===r&&(r=!1),Is(n,t.m_(r?4:3,e))}function Is(t,e){if(t instanceof cs&&(t=t.a_),Os(t))return _s("Unsupported field value:",e,t),Es(t,e);if(t instanceof es)return function(t,e){if(!ds(e.Zl))throw e.t_(t.Jl+"() can only be used with update() and set()");if(!e.path)throw e.t_(t.Jl+"() is not currently supported inside arrays");var n=t.Xl(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Qe.push(e.path),t instanceof Array){if(e.settings.n_&&4!==e.Zl)throw e.t_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var u=Is(o[i],e.T_(r));null==u&&(u={nullValue:"NULL_VALUE"}),n.push(u),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Zt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=V.fromDate(t);return{timestampValue:$t(e.serializer,n)}}if(t instanceof V){var r=new V(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:$t(e.serializer,r)}}if(t instanceof as)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof T)return{bytesValue:te(e.serializer,t.l)};if(t instanceof fs){var i=e._,o=t.c_;if(!o.isEqual(i))throw e.t_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:re(t.c_||e._,t.u_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.t_("Unsupported field value: "+Ju(t))}(t,e)}function Es(t,e){var n={};return P(t)?e.path&&e.path.length>0&&e.Qe.push(e.path):S(t,(function(t,r){var i=Is(r,e.d_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Os(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof V||t instanceof as||t instanceof T||t instanceof fs||t instanceof es)}function _s(t,e,n){if(!Os(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Ju(n);throw"an object"===r?e.t_(t+" a custom object"):e.t_(t+" "+r)}}function Ts(t,e,n){if(e instanceof Zu)return e.Yl;if("string"==typeof e)return Ns(t,e);throw As("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Ns(t,n,r){try{return function(t){if(t.search(ts)>=0)throw new c(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new($u.bind.apply($u,Object(e.g)([void 0],t.split("."))))}catch(n){throw new c(a.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(n).Yl}catch(n){throw As((i=n)instanceof Error?i.message:i.toString(),t,!1,void 0,r)}var i}function As(t,e,n,r,i){var o=r&&!r.P(),u=void 0!==i,s="Function "+e+"() called with invalid data";n&&(s+=" (via `toFirestore()`)");var h="";return(o||u)&&(h+=" (found",o&&(h+=" in field "+r),u&&(h+=" in document "+i),h+=")"),new c(a.INVALID_ARGUMENT,(s+=". ")+t+h)}function Ds(t,e){return t.some((function(t){return t.isEqual(e)}))}var js=function(){function t(t){this.qc=t,this.A_=new Map,this.mutations=[],this.R_=!1,this.P_=null,this.g_=new Set}return t.prototype.y_=function(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r=this;return Object(e.d)(this,(function(i){switch(i.label){case 0:if(this.V_(),this.mutations.length>0)throw new c(a.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o,u,s,a;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=g(t),i=ce(r.serializer)+"/documents",o={documents:n.map((function(t){return oe(r.serializer,t)}))},[4,r.Dc("BatchGetDocuments",i,o)];case 1:return u=e.sent(),s=new Map,u.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){m(!!e.found),e.found.name,e.found.updateTime;var n=ue(t,e.found.name),r=ne(e.found.updateTime),i=new on({mapValue:{fields:e.found.fields}});return new cn(n,r,i,{})}(t,e):"missing"in e?function(t,e){m(!!e.missing),m(!!e.readTime);var n=ue(t,e.missing),r=ne(e.readTime);return new hn(n,r)}(t,e):y()}(r.serializer,t);s.set(e.key.toString(),e)})),a=[],[2,(n.forEach((function(t){var e=s.get(t.toString());m(!!e),a.push(e)})),a)]}}))}))}(this.qc,t)];case 1:return[2,((n=i.sent()).forEach((function(t){t instanceof hn||t instanceof cn?r.p_(t):y()})),n)]}}))}))},t.prototype.set=function(t,e){this.write(e.l_(t,this.Ge(t))),this.g_.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.l_(t,this.b_(t)))}catch(t){this.P_=t}this.g_.add(t.toString())},t.prototype.delete=function(t){this.write([new nn(t,this.Ge(t))]),this.g_.add(t.toString())},t.prototype.commit=function(){return Object(e.b)(this,void 0,void 0,(function(){var t,n=this;return Object(e.d)(this,(function(r){switch(r.label){case 0:if(this.V_(),this.P_)throw this.P_;return t=this.A_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,e){var r=F.H(e);n.mutations.push(new rn(r,n.Ge(r)))})),[4,function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i,o;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=g(t),i=ce(r.serializer)+"/documents",o={writes:n.map((function(t){return le(r.serializer,t)}))},[4,r.Sc("Commit",i,o)];case 1:return e.sent(),[2]}}))}))}(this.qc,this.mutations)];case 1:return r.sent(),this.R_=!0,[2]}}))}))},t.prototype.p_=function(t){var e;if(t instanceof cn)e=t.version;else{if(!(t instanceof hn))throw y();e=R.min()}var n=this.A_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new c(a.ABORTED,"Document version changed between two reads.")}else this.A_.set(t.key.toString(),e)},t.prototype.Ge=function(t){var e=this.A_.get(t.toString());return!this.g_.has(t.toString())&&e?Be.updateTime(e):Be.ze()},t.prototype.b_=function(t){var e=this.A_.get(t.toString());if(!this.g_.has(t.toString())&&e){if(e.isEqual(R.min()))throw new c(a.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Be.updateTime(e)}return Be.exists(!0)},t.prototype.write=function(t){this.V_(),this.mutations=this.mutations.concat(t)},t.prototype.V_=function(){},t}(),ks=function(){function t(t,e,n,r){this.cs=t,this.qc=e,this.updateFunction=n,this.ls=r,this.v_=5,this.ys=new Qn(this.cs,"transaction_retry")}return t.prototype.run=function(){this.S_()},t.prototype.S_=function(){var t=this;this.ys.Pn((function(){return Object(e.b)(t,void 0,void 0,(function(){var t,n,r=this;return Object(e.d)(this,(function(e){return t=new js(this.qc),(n=this.D_(t))&&n.then((function(e){r.cs.ws((function(){return t.commit().then((function(){r.ls.resolve(e)})).catch((function(t){r.C_(t)}))}))})).catch((function(t){r.C_(t)})),[2]}))}))}))},t.prototype.D_=function(t){try{var e=this.updateFunction(t);return!B(e)&&e.catch&&e.then?e:(this.ls.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ls.reject(t),null}},t.prototype.C_=function(t){var e=this;this.v_>0&&this.N_(t)?(this.v_-=1,this.cs.ws((function(){return e.S_(),Promise.resolve()}))):this.ls.reject(t)},t.prototype.N_=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!tt(e)}return!1},t}(),xs=function(){function t(t,e,n){var r=this;this.credentials=t,this.cs=e,this.yl=n,this.user=mr.UNAUTHENTICATED,this.clientId=w.t(),this.x_=function(){},this.ui=new Wn,this.credentials.oi((function(t){l("FirestoreClient","Received user=",t.uid),r.user.isEqual(t)||(r.user=t,r.x_(t)),r.ui.resolve()}))}return t.prototype.getConfiguration=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return[4,this.ui.promise];case 1:return[2,(t.sent(),{cs:this.cs,yl:this.yl,clientId:this.clientId,credentials:this.credentials,ql:this.user,Dh:100})]}}))}))},t.prototype.F_=function(t){var e=this;this.x_=t,this.ui.promise.then((function(){return e.x_(e.user)}))},t.prototype.O_=function(){if(this.cs.ps)throw new c(a.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.cs.Ds();var n=new Wn;return this.cs.bs((function(){return Object(e.b)(t,void 0,void 0,(function(){var t,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),this.k_?[4,this.k_.terminate()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.M_?[4,this.M_.terminate()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.credentials.ai(),n.resolve(),[3,6];case 5:return t=e.sent(),r=ar(t,"Failed to shutdown persistence"),n.reject(r),[3,6];case 6:return[2]}}))}))})),n.promise},t}();function Ss(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i=this;return Object(e.d)(this,(function(o){switch(o.label){case 0:return t.cs.Fs(),l("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return r=o.sent(),[4,n.initialize(r)];case 2:return o.sent(),t.F_((function(r){return t.cs.Cs((function(){return Object(e.b)(i,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return[4,Gi(n.Bc,r)];case 1:return t.sent(),[2]}}))}))}))})),n.persistence.ha((function(){return t.terminate()})),t.M_=n,[2]}}))}))}function Ps(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(o){switch(o.label){case 0:return t.cs.Fs(),[4,Ls(t)];case 1:return r=o.sent(),l("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return i=o.sent(),[4,n.initialize(r,i)];case 3:return o.sent(),t.F_((function(r){return t.cs.Cs((function(){return function(t,n){return Object(e.b)(this,void 0,void 0,(function(){var r,i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(r=g(t)).cs.Fs(),l("RemoteStore","RemoteStore received new credentials"),i=mo(r),r.Wc.add(3),[4,co(r)];case 1:return e.sent(),i&&r.Hc.set("Unknown"),[4,r.Uc.Gl(n)];case 2:return e.sent(),r.Wc.delete(3),[4,ao(r)];case 3:return e.sent(),[2]}}))}))}(n.ph,r)}))})),t.k_=n,[2]}}))}))}function Ls(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return t.M_?[3,2]:(l("FirestoreClient","Using default OfflineComponentProvider"),[4,Ss(t,new Bu)]);case 1:e.sent(),e.label=2;case 2:return[2,t.M_]}}))}))}function Vs(t){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(e){switch(e.label){case 0:return t.k_?[3,2]:(l("FirestoreClient","Using default OnlineComponentProvider"),[4,Ps(t,new Ku)]);case 1:e.sent(),e.label=2;case 2:return[2,t.k_]}}))}))}function Rs(t){return Ls(t).then((function(t){return t.persistence}))}function Us(t){return Ls(t).then((function(t){return t.Bc}))}function Cs(t){return Vs(t).then((function(t){return t.ph}))}function qs(t){return Vs(t).then((function(t){return t.mu}))}function Ms(t){return Object(e.b)(this,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,Vs(t)];case 1:return n=e.sent(),[2,((r=n.bh).Us=Zo.bind(null,n.mu),r.Ws=tu.bind(null,n.mu),r)]}}))}))}function Fs(t,n,r,i){var o=this,u=new Wu(i),s=new yr(n,u,r);return t.cs.ws((function(){return Object(e.b)(o,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=fr,[4,Ms(t)];case 1:return[2,n.apply(void 0,[e.sent(),s])]}}))}))})),function(){u.Hl(),t.cs.ws((function(){return Object(e.b)(o,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=lr,[4,Ms(t)];case 1:return[2,n.apply(void 0,[e.sent(),s])]}}))}))}))}}function Bs(t,n){var r=this,i=new Wn;return t.cs.ws((function(){return Object(e.b)(r,void 0,void 0,(function(){var r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return r=eu,[4,qs(t)];case 1:return[2,r.apply(void 0,[e.sent(),n,i])]}}))}))})),i.promise}function zs(t,n){var r=this,i=new Wu(n);return t.cs.ws((function(){return Object(e.b)(r,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=function(t,e){g(t).qs.add(e),e.next()},[4,Ms(t)];case 1:return[2,n.apply(void 0,[e.sent(),i])]}}))}))})),function(){i.Hl(),t.cs.ws((function(){return Object(e.b)(r,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=function(t,e){g(t).qs.delete(e)},[4,Ms(t)];case 1:return[2,n.apply(void 0,[e.sent(),i])]}}))}))}))}}function Gs(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var Ks=function(){function t(t,e,n,r){this._=t,this.L_=e,this.B_=n,this.q_=r}return t.prototype.U_=function(t){switch(St(t)){case 0:return null;case 1:return t.booleanValue;case 2:return qt(t.integerValue||t.doubleValue);case 3:return this.K_(t.timestampValue);case 4:return this.Q_(t);case 5:return t.stringValue;case 6:return this.q_(Mt(t.bytesValue));case 7:return this.W_(t.referenceValue);case 8:return this.j_(t.geoPointValue);case 9:return this.G_(t.arrayValue);case 10:return this.z_(t.mapValue);default:throw y()}},t.prototype.z_=function(t){var e=this,n={};return S(t.fields||{},(function(t,r){n[t]=e.U_(r)})),n},t.prototype.j_=function(t){return new as(qt(t.latitude),qt(t.longitude))},t.prototype.G_=function(t){var e=this;return(t.values||[]).map((function(t){return e.U_(t)}))},t.prototype.Q_=function(t){switch(this.L_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return jt(n)?t(n):n}(t);return null==e?null:this.U_(e);case"estimate":return this.K_(kt(t));default:return null}},t.prototype.K_=function(t){var e=Ct(t);return new V(e.seconds,e.nanos)},t.prototype.W_=function(t){var e=C.q(t);m(Ne(e));var n=new k(e.get(1),e.get(3)),r=new F(e.N(5));return n.isEqual(this._)||p("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this._.projectId+"/"+this._.database+") instead."),this.B_(r)},t}(),Ws=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new c(a.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new c(a.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Yu("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}();function Qs(t){Js(t);var e=ea(t),n=t.H_(),r=new Ku;return Hs(e,r,new Gu(r,n.cacheSizeBytes))}function Hs(t,n,r){var i=this,o=new Wn;return t.cs.enqueue((function(){return Object(e.b)(i,void 0,void 0,(function(){var i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,Ss(t,r)];case 1:return e.sent(),[4,Ps(t,n)];case 2:return e.sent(),o.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===a.FAILED_PRECONDITION||t.code===a.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(i=e.sent()))throw i;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),o.reject(i),[3,4];case 4:return[2]}}))}))})).then((function(){return o.promise}))}function Ys(t){var n=this;if(t.Y_&&!t.J_)throw new c(a.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new Wn;return t.X_.bs((function(){return Object(e.b)(n,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return Yn.Ln()?(n=t+"main",[4,Yn.delete(n)]):[2,Promise.resolve()];case 1:return e.sent(),[2]}}))}))}(Bi(t.c_,t.Z_))];case 1:return i.sent(),r.resolve(),[3,3];case 2:return n=i.sent(),r.reject(n),[3,3];case 3:return[2]}}))}))})),r.promise}function Js(t){if(t.Y_||t.J_)throw new c(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Xs="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Zs=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){throw new c(a.FAILED_PRECONDITION,Xs)},t.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new c(a.FAILED_PRECONDITION,Xs)},t.prototype.clearIndexedDbPersistence=function(t){throw new c(a.FAILED_PRECONDITION,Xs)},t}(),$s=function(){function t(){this.enableMultiTabIndexedDbPersistence=Qs.bind(null),this.clearIndexedDbPersistence=Ys.bind(null)}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Js(t);var n=ea(t),r=t.H_(),i=new Ku;return Hs(n,i,new zu(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t,{forceOwnership:e})},t}(),ta=function(){function t(n,r,i){var o=this;if(void 0===i&&(i=new Zs),this.tf=i,this.ef=null,this.X_=new sr,this.INTERNAL={delete:function(){return Object(e.b)(o,void 0,void 0,(function(){return Object(e.d)(this,(function(t){switch(t.label){case 0:return this.nf||na(this),[4,this.nf.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof n.options){var u=n;this.ef=u,this.c_=t.sf(u),this.Z_=u.name,this.if=new wr(r)}else{var s=n;if(!s.projectId)throw new c(a.INVALID_ARGUMENT,"Must provide projectId");this.c_=new k(s.projectId,s.database),this.Z_="[DEFAULT]",this.if=new br}this.rf=new Ws({})}return Object.defineProperty(t.prototype,"Y_",{get:function(){return!!this.nf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"J_",{get:function(){return this.X_.ps},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"af",{get:function(){return this.cf||(this.cf=new ys(this.c_,this.rf.ignoreUndefinedProperties)),this.cf},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.rf),t)).merge;var e=new Ws(t);if(this.nf&&!this.rf.isEqual(e))throw new c(a.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.rf=e,void 0!==e.credentials&&(this.if=function(t){if(!t)return new br;switch(t.type){case"gapi":var e=t.client;return m(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Er(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new c(a.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this.rf.host&&d("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},t.prototype.enableNetwork=function(){return ea(this),function(t){var n=this;return t.cs.enqueue((function(){return Object(e.b)(n,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,Rs(t)];case 1:return n=e.sent(),[4,Cs(t)];case 2:return r=e.sent(),[2,(n.la(!0),function(t){var e=g(t);return e.Wc.delete(0),ao(e)}(r))]}}))}))}))}(this.nf)},t.prototype.disableNetwork=function(){return ea(this),function(t){var n=this;return t.cs.enqueue((function(){return Object(e.b)(n,void 0,void 0,(function(){var n,r;return Object(e.d)(this,(function(i){switch(i.label){case 0:return[4,Rs(t)];case 1:return n=i.sent(),[4,Cs(t)];case 2:return r=i.sent(),[2,(n.la(!1),function(t){return Object(e.b)(this,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return(n=g(t)).Wc.add(0),[4,co(n)];case 1:return e.sent(),n.Hc.set("Offline"),[2]}}))}))}(r))]}}))}))}))}(this.nf)},t.prototype.enablePersistence=function(t){if(this.nf)throw new c(a.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1,n=!1;return t&&Yu("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.tf.enableMultiTabIndexedDbPersistence(this):this.tf.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return Object(e.b)(this,void 0,void 0,(function(){return Object(e.d)(this,(function(t){return[2,this.tf.clearIndexedDbPersistence(this)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},t.prototype.waitForPendingWrites=function(){return ea(this),function(t){var n=this,r=new Wn;return t.cs.ws((function(){return Object(e.b)(n,void 0,void 0,(function(){var n;return Object(e.d)(this,(function(e){switch(e.label){case 0:return n=su,[4,qs(t)];case 1:return[2,n.apply(void 0,[e.sent(),r])]}}))}))})),r.promise}(this.nf)},t.prototype.onSnapshotsInSync=function(t){if(ea(this),Gs(t))return zs(this.nf,t);var e={next:t};return zs(this.nf,e)},t.sf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new c(a.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new c(a.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new k(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.ef)throw new c(a.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.ef},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return Qu("Firestore.collection","path",t),ea(this),new va(C.q(t),this,null)},t.prototype.doc=function(t){return Qu("Firestore.doc","path",t),ea(this),oa.uf(C.q(t),this,null)},t.prototype.collectionGroup=function(t){if(Qu("Firestore.collectionGroup","collectionId",t),t.indexOf("/")>=0)throw new c(a.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return ea(this),new pa(function(t){return new ln(C.U(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var n=this;return function(t,n){var r=this,i=new Wn;return t.cs.ws((function(){return Object(e.b)(r,void 0,void 0,(function(){var r;return Object(e.d)(this,(function(e){switch(e.label){case 0:return[4,function(t){return Vs(t).then((function(t){return t.qc}))}(t)];case 1:return r=e.sent(),new ks(t.cs,r,n,i).run(),[2]}}))}))})),i.promise}(ea(this),(function(e){return t(new ra(n,e))}))},t.prototype.batch=function(){return ea(this),new ia(this)},t.prototype.H_=function(){return this.rf},t}();function ea(t){return t.nf||na(t),t.nf.O_(),t.nf}function na(t){var e=t.H_(),n=function(t,e,n){return new j(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.c_,t.Z_,e);t.nf=new xs(t.if,t.X_,n)}var ra=function(){function t(t,e){this.hf=t,this.lf=e}return t.prototype.get=function(t){var e=this,n=ya("Transaction.get",t,this.hf);return this.lf.y_([n.u_]).then((function(t){if(!t||1!==t.length)return y();var r=t[0];if(r instanceof hn)return new sa(e.hf,n.u_,null,!1,!1,n.h_);if(r instanceof cn)return new sa(e.hf,n.u_,r,!1,!1,n.h_);throw y()}))},t.prototype.set=function(t,e,n){var r=ya("Transaction.set",t,this.hf);n=Hu("Transaction.set",n);var i=ga(r.h_,e,n),o=ms(this.hf.af,"Transaction.set",r.u_,i,null!==r.h_,n);return this.lf.set(r.u_,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],u=3;u<arguments.length;u++)o[u-3]=arguments[u];return"string"==typeof e||e instanceof $u?(r=ya("Transaction.update",t,this.hf),i=bs(this.hf.af,"Transaction.update",r.u_,e,n,o)):(r=ya("Transaction.update",t,this.hf),i=gs(this.hf.af,"Transaction.update",r.u_,e)),this.lf.update(r.u_,i),this},t.prototype.delete=function(t){var e=ya("Transaction.delete",t,this.hf);return this.lf.delete(e.u_),this},t}(),ia=function(){function t(t){this.hf=t,this._f=[],this.ff=!1}return t.prototype.set=function(t,e,n){this.df();var r=ya("WriteBatch.set",t,this.hf);n=Hu("WriteBatch.set",n);var i=ga(r.h_,e,n),o=ms(this.hf.af,"WriteBatch.set",r.u_,i,null!==r.h_,n);return this._f=this._f.concat(o.l_(r.u_,Be.ze())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],u=3;u<arguments.length;u++)o[u-3]=arguments[u];return this.df(),"string"==typeof e||e instanceof $u?(r=ya("WriteBatch.update",t,this.hf),i=bs(this.hf.af,"WriteBatch.update",r.u_,e,n,o)):(r=ya("WriteBatch.update",t,this.hf),i=gs(this.hf.af,"WriteBatch.update",r.u_,e)),this._f=this._f.concat(i.l_(r.u_,Be.exists(!0))),this},t.prototype.delete=function(t){this.df();var e=ya("WriteBatch.delete",t,this.hf);return this._f=this._f.concat(new nn(e.u_,Be.ze())),this},t.prototype.commit=function(){return this.df(),this.ff=!0,this._f.length>0?Bs(ea(this.hf),this._f):Promise.resolve()},t.prototype.df=function(){if(this.ff)throw new c(a.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),oa=function(t){function n(e,n,r){var i=this;return(i=t.call(this,n.c_,e,r)||this).u_=e,i.firestore=n,i.h_=r,i.nf=ea(n),i}return Object(e.c)(n,t),n.uf=function(t,e,r){if(t.length%2!=0)throw new c(a.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.B()+" has "+t.length);return new n(new F(t),e,r)},Object.defineProperty(n.prototype,"id",{get:function(){return this.u_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new va(this.u_.path.F(),this.firestore,this.h_)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.u_.path.B()},enumerable:!1,configurable:!0}),n.prototype.collection=function(t){if(Qu("DocumentReference.collection","path",t),!t)throw new c(a.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=C.q(t);return new va(this.u_.path.child(e),this.firestore,null)},n.prototype.isEqual=function(t){return t instanceof n&&this.firestore===t.firestore&&this.u_.isEqual(t.u_)&&this.h_===t.h_},n.prototype.set=function(t,e){e=Hu("DocumentReference.set",e);var n=ga(this.h_,t,e),r=ms(this.firestore.af,"DocumentReference.set",this.u_,n,null!==this.h_,e);return Bs(this.nf,r.l_(this.u_,Be.ze()))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof $u?bs(this.firestore.af,"DocumentReference.update",this.u_,t,e,r):gs(this.firestore.af,"DocumentReference.update",this.u_,t),Bs(this.nf,n.l_(this.u_,Be.exists(!0)))},n.prototype.delete=function(){return Bs(this.nf,[new nn(this.u_,Be.ze())])},n.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var u={includeMetadataChanges:!1},s=0;"object"!=typeof i[s]||Gs(i[s])||(u=i[s],s++);var a={includeMetadataChanges:u.includeMetadataChanges};if(Gs(i[s])){var c=i[s];i[s]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[s+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[s+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}var h={next:function(t){i[s]&&i[s](r.wf(t))},error:i[s+1],complete:i[s+2]};return Fs(this.nf,dn(this.u_.path),a,h)},n.prototype.get=function(t){var n=this;return t&&"cache"===t.source?function(t,n){var r=this,i=new Wn;return t.cs.ws((function(){return Object(e.b)(r,void 0,void 0,(function(){var r;return Object(e.d)(this,(function(o){switch(o.label){case 0:return r=function(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,function(t,e){var n=g(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Ka.Mi(t,e)}))}(t,n)];case 1:return(i=e.sent())instanceof cn?r.resolve(i):i instanceof hn?r.resolve(null):r.reject(new c(a.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return o=e.sent(),u=ar(o,"Failed to get document '"+n+" from cache"),r.reject(u),[3,3];case 3:return[2]}}))}))},[4,Us(t)];case 1:return[2,r.apply(void 0,[o.sent(),n,i])]}}))}))})),i.promise}(this.nf,this.u_).then((function(t){return new sa(n.firestore,n.u_,t,!0,t instanceof cn&&t.Je,n.h_)})):function(t,n,r){var i=this;void 0===r&&(r={});var o=new Wn;return t.cs.ws((function(){return Object(e.b)(i,void 0,void 0,(function(){var i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return i=function(t,e,n,r,i){var o=new Wu({next:function(o){e.ws((function(){return lr(t,u)}));var s=o.docs.has(n);!s&&o.fromCache?i.reject(new c(a.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new c(a.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),u=new yr(dn(n.path),o,{includeMetadataChanges:!0,Xs:!0});return fr(t,u)},[4,Ms(t)];case 1:return[2,i.apply(void 0,[e.sent(),t.cs,n,r,o])]}}))}))})),o.promise}(this.nf,this.u_,t).then((function(t){return n.wf(t)}))},n.prototype.withConverter=function(t){return new n(this.u_,this.firestore,t)},n.prototype.wf=function(t){var e=t.docs.get(this.u_);return new sa(this.firestore,this.u_,e,t.fromCache,t.hasPendingWrites,this.h_)},n}(fs),ua=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),sa=function(){function t(t,e,n,r,i,o){this.hf=t,this.u_=e,this.Ef=n,this.Tf=r,this.If=i,this.h_=o}return t.prototype.data=function(t){var e=this;if(void 0===t&&(t={}),this.Ef){if(this.h_){var n=new aa(this.hf,this.u_,this.Ef,this.Tf,this.If,null);return this.h_.fromFirestore(n,t)}return new Ks(this.hf.c_,t.serverTimestamps||"none",(function(t){return new oa(t,e.hf,null)}),(function(t){return new D(t)})).U_(this.Ef.rn())}},t.prototype.get=function(t,e){var n=this;if(void 0===e&&(e={}),this.Ef){var r=this.Ef.data().field(Ts("DocumentSnapshot.get",t,this.u_));if(null!==r)return new Ks(this.hf.c_,e.serverTimestamps||"none",(function(t){return new oa(t,n.hf,n.h_)}),(function(t){return new D(t)})).U_(r)}},Object.defineProperty(t.prototype,"id",{get:function(){return this.u_.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new oa(this.u_,this.hf,this.h_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Ef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new ua(this.If,this.Tf)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&this.hf===e.hf&&this.Tf===e.Tf&&this.u_.isEqual(e.u_)&&(null===this.Ef?null===e.Ef:this.Ef.isEqual(e.Ef))&&this.h_===e.h_},t}(),aa=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.prototype.data=function(e){return t.prototype.data.call(this,e)},n}(sa);function ca(t,e,n){if("string"==typeof n){if(""===n)throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!bn(e)&&-1!==n.indexOf("/"))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(C.q(n));if(!F.X(r))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ft(t,new F(r))}if(n instanceof fs)return Ft(t,n.u_);throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ju(n)+".")}function ha(t,e){if(!Array.isArray(t)||0===t.length)throw new c(a.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new c(a.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function fa(t,e,n){if(!n.isEqual(e))throw new c(a.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function la(t){if(yn(t)&&0===t.on.length)throw new c(a.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pa=function(){function t(t,e,n){this.mf=t,this.firestore=e,this.h_=n}return t.prototype.where=function(e,n,r){var i=Ts("Query.where",e),o=function(t,e,n,r,i,o,u){var s;if(i.W()){if("array-contains"===o||"array-contains-any"===o)throw new c(a.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){ha(u,o);for(var h=[],f=0,l=u;f<l.length;f++){var p=l[f];h.push(ca(r,t,p))}s={arrayValue:{values:h}}}else s=ca(r,t,u)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||ha(u,o),s=ws(n,"Query.where",u,"in"===o||"not-in"===o);var d=kn.create(i,o,s);return function(t,e){if(e.hn()){var n=gn(t);if(null!==n&&!n.isEqual(e.field))throw new c(a.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=mn(t);null!==r&&fa(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new c(a.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new c(a.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}(this.mf,0,this.firestore.af,this.firestore.c_,i,n,r);return new t(function(t,e){var n=t.filters.concat([e]);return new ln(t.path,t.collectionGroup,t.on.slice(),n,t.limit,t.an,t.startAt,t.endAt)}(this.mf,o),this.firestore,this.h_)},t.prototype.orderBy=function(e,n){var r;if(void 0===n||"asc"===n)r="asc";else{if("desc"!==n)throw new c(a.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r="desc"}var i=Ts("Query.orderBy",e),o=function(t,e,n){if(null!==t.startAt)throw new c(a.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new c(a.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new zn(e,n);return function(t,e){if(null===mn(t)){var n=gn(t);null!==n&&fa(0,n,e.field)}}(t,r),r}(this.mf,i,r);return new t(function(t,e){var n=t.on.concat([e]);return new ln(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.an,t.startAt,t.endAt)}(this.mf,o),this.firestore,this.h_)},t.prototype.limit=function(e){return Xu("Query.limit",e),new t(En(this.mf,e,"F"),this.firestore,this.h_)},t.prototype.limitToLast=function(e){return Xu("Query.limitToLast",e),new t(En(this.mf,e,"L"),this.firestore,this.h_)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Af("Query.startAt",e,n,!0);return new t(On(this.mf,i),this.firestore,this.h_)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Af("Query.startAfter",e,n,!1);return new t(On(this.mf,i),this.firestore,this.h_)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Af("Query.endBefore",e,n,!0);return new t(_n(this.mf,i),this.firestore,this.h_)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.Af("Query.endAt",e,n,!1);return new t(_n(this.mf,i),this.firestore,this.h_)},t.prototype.isEqual=function(e){return e instanceof t&&this.firestore===e.firestore&&Tn(this.mf,e.mf)&&this.h_===e.h_},t.prototype.withConverter=function(e){return new t(this.mf,this.firestore,e)},t.prototype.Af=function(t,e,n,r){if(e instanceof sa)return function(t,e,n,r,i){if(!r)throw new c(a.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],u=0,s=wn(t);u<s.length;u++){var h=s[u];if(h.field.W())o.push(Ft(e,r.key));else{var f=r.field(h.field);if(jt(f))throw new c(a.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===f){var l=h.field.B();throw new c(a.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(f)}}return new qn(o,i)}(this.mf,this.firestore.c_,t,e.Ef,r);var i=[e].concat(n);return function(t,e,n,r,i,o){var u=t.on;if(i.length>u.length)throw new c(a.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],h=0;h<i.length;h++){var f=i[h];if(u[h].field.W()){if("string"!=typeof f)throw new c(a.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof f);if(!bn(t)&&-1!==f.indexOf("/"))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+f+"' contains a slash.");var l=t.path.child(C.q(f));if(!F.X(l))throw new c(a.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");var p=new F(l);s.push(Ft(e,p))}else{var d=ws(n,r,f);s.push(d)}}return new qn(s,o)}(this.mf,this.firestore.c_,this.firestore.af,t,i,r)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var u={},s=0;if("object"!=typeof i[s]||Gs(i[s])||(u=i[s],s++),Gs(i[s])){var a=i[s];i[s]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[s+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[s+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}var c={next:function(t){i[s]&&i[s](new da(r.firestore,r.mf,t,r.h_))},error:i[s+1],complete:i[s+2]};return la(this.mf),Fs(ea(this.firestore),this.mf,u,c)},t.prototype.get=function(t){var n=this;la(this.mf);var r=ea(this.firestore);return(t&&"cache"===t.source?function(t,n){var r=this,i=new Wn;return t.cs.ws((function(){return Object(e.b)(r,void 0,void 0,(function(){var r;return Object(e.d)(this,(function(o){switch(o.label){case 0:return r=function(t,n,r){return Object(e.b)(this,void 0,void 0,(function(){var i,o,u,s,a,c;return Object(e.d)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Xi(t,n,!0)];case 1:return i=e.sent(),o=new Ho(n,i.za),u=o.wh(i.documents),s=o.Di(u,!1),r.resolve(s.snapshot),[3,3];case 2:return a=e.sent(),c=ar(a,"Failed to execute query '"+n+" against cache"),r.reject(c),[3,3];case 3:return[2]}}))}))},[4,Us(t)];case 1:return[2,r.apply(void 0,[o.sent(),n,i])]}}))}))})),i.promise}(r,this.mf):function(t,n,r){var i=this;void 0===r&&(r={});var o=new Wn;return t.cs.ws((function(){return Object(e.b)(i,void 0,void 0,(function(){var i;return Object(e.d)(this,(function(e){switch(e.label){case 0:return i=function(t,e,n,r,i){var o=new Wu({next:function(n){e.ws((function(){return lr(t,u)})),n.fromCache&&"server"===r.source?i.reject(new c(a.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),u=new yr(n,o,{includeMetadataChanges:!0,Xs:!0});return fr(t,u)},[4,Ms(t)];case 1:return[2,i.apply(void 0,[e.sent(),t.cs,n,r,o])]}}))}))})),o.promise}(r,this.mf,t)).then((function(t){return new da(n.firestore,n.mf,t,n.h_)}))},t}(),da=function(){function t(t,e,n,r){this.hf=t,this.Rf=e,this.Pf=n,this.h_=r,this.gf=null,this.yf=null,this.metadata=new ua(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.Pf.docs.P()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.Pf.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this.Pf.docs.forEach((function(r){t.call(e,n.Vf(r,n.metadata.fromCache,n.Pf.Qt.has(r.key)))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new pa(this.Rf,this.hf,this.h_)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=!(!t||!t.includeMetadataChanges);if(e&&this.Pf.jt)throw new c(a.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.gf&&this.yf===e||(this.gf=function(t,e,n){if(t.Kt.P()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Qt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Kt;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Qt.has(e.doc.key)),o=-1,u=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(u=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:ma(e.type),doc:r,oldIndex:o,newIndex:u}}))}(this.Pf,e,this.Vf.bind(this)),this.yf=e),this.gf},t.prototype.isEqual=function(e){return e instanceof t&&this.hf===e.hf&&Tn(this.Rf,e.Rf)&&this.Pf.isEqual(e.Pf)&&this.h_===e.h_},t.prototype.Vf=function(t,e,n){return new aa(this.hf,t.key,t,e,n,this.h_)},t}(),va=function(t){function n(e,n,r){var i=this;if((i=t.call(this,dn(e),n,r)||this).pf=e,e.length%2!=1)throw new c(a.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.B()+" has "+e.length);return i}return Object(e.c)(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this.mf.path.k()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this.mf.path.F();return t.P()?null:new oa(new F(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this.mf.path.B()},enumerable:!1,configurable:!0}),n.prototype.doc=function(t){0===arguments.length&&(t=w.t()),Qu("CollectionReference.doc","path",t);var e=C.q(t);return oa.uf(this.mf.path.child(e),this.firestore,this.h_)},n.prototype.add=function(t){var e=this.h_?this.h_.toFirestore(t):t,n=this.doc();return new oa(n.u_,this.firestore,null).set(e).then((function(){return n}))},n.prototype.withConverter=function(t){return new n(this.pf,this.firestore,t)},n}(pa);function ya(t,e,n){var r=function(t,e){if(!(t instanceof e)){if(e.name===t.constructor.name)throw new c(a.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ju(t);throw new c(a.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}(e,oa);if(r.firestore!==n)throw new c(a.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function ma(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return y()}}function ga(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ba,wa=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(e.c)(n,t),n.serverTimestamp=function(){var t=new is("serverTimestamp");return t.Jl="FieldValue.serverTimestamp",new n(t)},n.delete=function(){var t=new ns("deleteField");return t.Jl="FieldValue.delete",new n(t)},n.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new os("arrayUnion",t)}.apply(void 0,t);return r.Jl="FieldValue.arrayUnion",new n(r)},n.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new us("arrayRemove",t)}.apply(void 0,t);return r.Jl="FieldValue.arrayRemove",new n(r)},n.increment=function(t){var e=function(t){return new ss("increment",t)}(t);return e.Jl="FieldValue.increment",new n(e)},n.prototype.isEqual=function(t){return this.a_.isEqual(t.a_)},n}(cs),Ia={Firestore:ta,GeoPoint:as,Timestamp:V,Blob:D,Transaction:ra,WriteBatch:ia,DocumentReference:oa,DocumentSnapshot:sa,Query:pa,QueryDocumentSnapshot:aa,QuerySnapshot:da,CollectionReference:va,FieldPath:$u,FieldValue:wa,setLogLevel:function(t){var e;e=t,h.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new s.a("firestore",(function(t){return function(t,e){return new ta(t,e,new $s)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Ia)))})(ba=r.a),ba.registerVersion("@firebase/firestore","2.0.1")}).call(this,n("8oxB"))}}]);